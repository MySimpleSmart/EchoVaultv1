{"ast":null,"code":"import React,{useState,useEffect}from'react';import'./Login.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Login=_ref=>{let{onLoginSuccess}=_ref;const[username,setUsername]=useState('');const[password,setPassword]=useState('');const[loading,setLoading]=useState(false);const[error,setError]=useState('');useEffect(()=>{const savedUsername=localStorage.getItem('user_portal_username');if(savedUsername)setUsername(savedUsername);},[]);const handleSubmit=async e=>{e.preventDefault();setLoading(true);setError('');try{const apiBase=typeof window!=='undefined'&&window.REACT_APP_API_URL||process.env.REACT_APP_API_URL||\"\".concat(window.location.origin,\"/wp-json\");const response=await fetch(\"\".concat(apiBase,\"/jwt-auth/v1/token\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password}),mode:'cors'});const data=await response.json();if(response.ok&&data.token){localStorage.setItem('jwt_token',data.token);// Try to get user email\nlet userEmail=data.user_email||data.email||'';try{const validateResp=await fetch(\"\".concat(apiBase,\"/jwt-auth/v1/token/validate\"),{method:'POST',headers:{Authorization:\"Bearer \".concat(data.token),'Content-Type':'application/json'},mode:'cors'});if(validateResp.ok){var _v$data;const v=await validateResp.json();userEmail=((_v$data=v.data)===null||_v$data===void 0?void 0:_v$data.user_email)||userEmail;}}catch(e){}const userData={username,email:userEmail,user_email:userEmail};localStorage.setItem('user',JSON.stringify(userData));localStorage.setItem('user_portal_username',username);onLoginSuccess(data.token,userData);}else{setError(data.message||'Login failed. Please check your credentials.');}}catch(err){setError('Network error. Please try again.');}finally{setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-100 flex items-center justify-center p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-full max-w-md\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-md p-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-8\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/Logo/echologo.png\",alt:\"EchoVault\",className:\"mx-auto mb-4 h-12 w-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm\",children:\"Client Portal\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:username,onChange:e=>setUsername(e.target.value),required:true,disabled:loading,className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-50\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Password\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),required:true,disabled:loading,className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-50\"})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border border-red-200 rounded-md p-3\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-red-700 text-sm\",children:error})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"w-full bg-blue-600 text-white py-2 px-4 rounded-md font-medium hover:bg-blue-700 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50\",children:loading?'Signing in...':'Sign In'})]})]})})});};export default Login;","map":{"version":3,"names":["React","useState","useEffect","jsx","_jsx","jsxs","_jsxs","Login","_ref","onLoginSuccess","username","setUsername","password","setPassword","loading","setLoading","error","setError","savedUsername","localStorage","getItem","handleSubmit","e","preventDefault","apiBase","window","REACT_APP_API_URL","process","env","concat","location","origin","response","fetch","method","headers","body","JSON","stringify","mode","data","json","ok","token","setItem","userEmail","user_email","email","validateResp","Authorization","_v$data","v","userData","message","err","className","children","src","alt","onSubmit","type","value","onChange","target","required","disabled"],"sources":["/Volumes/Main Data/EchoVault LMS/EchoVault v1/echovault-user-frontend/src/Login.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport './Login.css';\n\nconst Login = ({ onLoginSuccess }) => {\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    const savedUsername = localStorage.getItem('user_portal_username');\n    if (savedUsername) setUsername(savedUsername);\n  }, []);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    try {\n      const apiBase =\n        (typeof window !== 'undefined' && window.REACT_APP_API_URL) ||\n        process.env.REACT_APP_API_URL ||\n        `${window.location.origin}/wp-json`;\n      const response = await fetch(`${apiBase}/jwt-auth/v1/token`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ username, password }),\n        mode: 'cors',\n      });\n\n      const data = await response.json();\n\n      if (response.ok && data.token) {\n        localStorage.setItem('jwt_token', data.token);\n\n        // Try to get user email\n        let userEmail = data.user_email || data.email || '';\n        try {\n          const validateResp = await fetch(`${apiBase}/jwt-auth/v1/token/validate`, {\n            method: 'POST',\n            headers: {\n              Authorization: `Bearer ${data.token}`,\n              'Content-Type': 'application/json',\n            },\n            mode: 'cors',\n          });\n          if (validateResp.ok) {\n            const v = await validateResp.json();\n            userEmail = v.data?.user_email || userEmail;\n          }\n        } catch (e) {}\n\n        const userData = { username, email: userEmail, user_email: userEmail };\n        localStorage.setItem('user', JSON.stringify(userData));\n        localStorage.setItem('user_portal_username', username);\n\n        onLoginSuccess(data.token, userData);\n      } else {\n        setError(data.message || 'Login failed. Please check your credentials.');\n      }\n    } catch (err) {\n      setError('Network error. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"bg-white rounded-lg shadow-md p-8\">\n          <div className=\"text-center mb-8\">\n            <img\n              src=\"/Logo/echologo.png\"\n              alt=\"EchoVault\"\n              className=\"mx-auto mb-4 h-12 w-auto\"\n            />\n            <p className=\"text-gray-600 text-sm\">Client Portal</p>\n          </div>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Username\n              </label>\n              <input\n                type=\"text\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                required\n                disabled={loading}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-50\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Password\n              </label>\n              <input\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n                disabled={loading}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-50\"\n              />\n            </div>\n            {error && (\n              <div className=\"bg-red-50 border border-red-200 rounded-md p-3\">\n                <p className=\"text-red-700 text-sm\">{error}</p>\n              </div>\n            )}\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full bg-blue-600 text-white py-2 px-4 rounded-md font-medium hover:bg-blue-700 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50\"\n            >\n              {loading ? 'Signing in...' : 'Sign In'}\n            </button>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Login;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}