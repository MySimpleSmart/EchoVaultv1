{"ast":null,"code":"import _objectSpread from\"/Volumes/Main Data/EchoVault LMS/EchoVault v1/echovault-user-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import{BrowserRouter,Routes,Route,useNavigate,useParams,useLocation}from'react-router-dom';import Login from'./Login';import Sidebar from'./Sidebar';import Header from'./Header';import'./App.css';import'./styles.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const apiBase=typeof window!=='undefined'&&window.REACT_APP_API_URL||process.env.REACT_APP_API_URL||\"\".concat(window.location.origin,\"/wp-json\");function getAuthHeaders(token){return{'Content-Type':'application/json',Authorization:\"Bearer \".concat(token)};}// Helper function to extract ID from various formats (matching admin side logic)\nconst toId=val=>{if(val===null||val===undefined)return'';if(typeof val==='number'||typeof val==='string')return String(val);if(Array.isArray(val))return toId(val[0]);if(typeof val==='object'){if('id'in val)return String(val.id);if('ID'in val)return String(val.ID);}return'';};// Helper function to check if a loan belongs to a borrower profile\nconst isLoanForBorrower=(loan,profile)=>{var _profile$meta,_loan$meta,_loan$meta2,_loan$meta3,_loan$fields,_loan$acf,_loan$fields2,_loan$acf2;if(!loan||!profile)return false;const profileId=String(profile.id);const profileEmail=(profile.email_address||((_profile$meta=profile.meta)===null||_profile$meta===void 0?void 0:_profile$meta.email_address)||'').toString().toLowerCase().trim();// Try multiple ways to extract borrower ID from loan (matching admin side logic)\nlet borrowerId=toId((_loan$meta=loan.meta)===null||_loan$meta===void 0?void 0:_loan$meta.borrower_id)||toId(loan.borrower)||toId((_loan$meta2=loan.meta)===null||_loan$meta2===void 0?void 0:_loan$meta2.borrower)||toId((_loan$meta3=loan.meta)===null||_loan$meta3===void 0?void 0:_loan$meta3.borrower_profile)||toId((_loan$fields=loan.fields)===null||_loan$fields===void 0?void 0:_loan$fields.borrower_id)||toId((_loan$acf=loan.acf)===null||_loan$acf===void 0?void 0:_loan$acf.borrower_id)||toId((_loan$fields2=loan.fields)===null||_loan$fields2===void 0?void 0:_loan$fields2.borrower)||toId((_loan$acf2=loan.acf)===null||_loan$acf2===void 0?void 0:_loan$acf2.borrower);// Check if borrower ID matches\nif(borrowerId&&String(borrowerId)===profileId){return true;}// Fallback: check by email if available\nif(profileEmail){var _loan$meta4,_loan$fields3;const loanBorrowerEmail=(((_loan$meta4=loan.meta)===null||_loan$meta4===void 0?void 0:_loan$meta4.borrower_email)||((_loan$fields3=loan.fields)===null||_loan$fields3===void 0?void 0:_loan$fields3.borrower_email)||'').toString().toLowerCase().trim();if(loanBorrowerEmail&&loanBorrowerEmail===profileEmail){return true;}}return false;};function useCurrentClient(token){const[profile,setProfile]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState('');useEffect(()=>{if(!token)return;let cancelled=false;const load=async()=>{setLoading(true);setError('');try{// 1) Get email from locally stored user (set at login)\nlet userEmail='';try{const stored=localStorage.getItem('user');if(stored){const parsed=JSON.parse(stored);userEmail=(parsed.user_email||parsed.email||'').toString().toLowerCase().trim();}}catch(_){}// 2) Fallback to /users/me only if we couldn't get it from localStorage\nif(!userEmail){const meResp=await fetch(\"\".concat(apiBase,\"/wp/v2/users/me\"),{method:'GET',headers:{Authorization:\"Bearer \".concat(token),'Content-Type':'application/json'},mode:'cors'});if(meResp.ok){const me=await meResp.json();userEmail=(me.email||me.user_email||me.user_email_address||'').toString().toLowerCase().trim();}}if(!userEmail){throw new Error('Current user email not found');}// 2) Load all borrowers visible to this token\nconst listResp=await fetch(\"\".concat(apiBase,\"/wp/v2/borrower-profile?per_page=100&context=edit\"),{headers:getAuthHeaders(token),mode:'cors'});if(!listResp.ok){throw new Error('Failed to load borrower profiles');}const list=await listResp.json();let matched=null;if(Array.isArray(list)&&list.length){matched=list.find(b=>{var _b$meta,_b$fields,_b$meta2,_b$fields2;const be=(b.email_address||b.email||((_b$meta=b.meta)===null||_b$meta===void 0?void 0:_b$meta.email_address)||((_b$fields=b.fields)===null||_b$fields===void 0?void 0:_b$fields.email_address)||((_b$meta2=b.meta)===null||_b$meta2===void 0?void 0:_b$meta2.borrower_email)||((_b$fields2=b.fields)===null||_b$fields2===void 0?void 0:_b$fields2.borrower_email)||'').toString().toLowerCase().trim();return be&&be===userEmail;})||null;}if(!matched){throw new Error('No borrower profile found for this account');}if(!cancelled){setProfile(matched);}}catch(e){if(!cancelled){setError(e.message||'Failed to load profile');setProfile(null);}}finally{if(!cancelled){setLoading(false);}}};load();return()=>{cancelled=true;};},[token]);return{profile,loading,error};}function DashboardPage(_ref){var _currentLoan$meta,_currentLoan$title,_currentLoan$title2;let{token,user}=_ref;const{profile,loading,error}=useCurrentClient(token);const[loans,setLoans]=useState([]);const[currentLoan,setCurrentLoan]=useState(null);const[nextPayment,setNextPayment]=useState(null);const[loanPayments,setLoanPayments]=useState([]);// Store next payment for each loan\nconst[currentLoanSchedule,setCurrentLoanSchedule]=useState([]);// Store schedule for current loan\nconst[paymentLoading,setPaymentLoading]=useState(false);const[latestNews,setLatestNews]=useState(null);const[newsLoading,setNewsLoading]=useState(false);const navigate=useNavigate();useEffect(()=>{if(!token||!profile)return;const loadLoans=async()=>{try{const resp=await fetch(\"\".concat(apiBase,\"/wp/v2/loans?per_page=100&context=edit\"),{headers:getAuthHeaders(token),mode:'cors'});if(!resp.ok)throw new Error('Failed to load loans');const data=await resp.json();// Use comprehensive filtering function\nconst filtered=data.filter(loan=>isLoanForBorrower(loan,profile));setLoans(filtered);// Get active loans\nconst activeLoans=filtered.filter(loan=>{var _loan$meta5;const status=((_loan$meta5=loan.meta)===null||_loan$meta5===void 0?void 0:_loan$meta5.loan_status)||loan.loan_status||'';return status&&!/^(closed|completed|cancelled)$/i.test(status);});if(activeLoans.length===0&&filtered.length>0){// If no active loans, use first loan\nactiveLoans.push(filtered[0]);}if(activeLoans.length>0){setPaymentLoading(true);// Fetch repayment schedules for all active loans\nconst allPayments=[];const loanPaymentMap=[];// Store next payment and schedule for each loan\nfor(const loan of activeLoans){try{const scheduleResp=await fetch(\"\".concat(apiBase,\"/echovault/v2/get-repayment-schedule?loan_id=\").concat(loan.id),{headers:{Authorization:\"Bearer \".concat(token)},mode:'cors'});if(scheduleResp.ok){const scheduleJson=await scheduleResp.json();if(scheduleJson.success&&scheduleJson.schedule&&Array.isArray(scheduleJson.schedule)){const schedule=scheduleJson.schedule;const today=new Date();today.setHours(0,0,0,0);const loanPayments=[];// Find all unpaid payments for this loan\nschedule.forEach(r=>{const status=(r.repayment_status||'').toLowerCase();if(status!=='paid'){// Use segment_end as payment date (fallback to repayment_date if available)\nconst paymentDateStr=r.segment_end||r.repayment_date||r.end_date;if(paymentDateStr){try{const paymentDate=new Date(paymentDateStr);paymentDate.setHours(0,0,0,0);const isOverdue=paymentDate<today;const paymentInfo=_objectSpread(_objectSpread({},r),{},{loan:loan,paymentDate:paymentDate,paymentDateStr:paymentDateStr,isOverdue});allPayments.push(paymentInfo);loanPayments.push(paymentInfo);}catch(e){console.error('Error parsing date:',paymentDateStr,e);}}}});// Find next payment for this loan (earliest unpaid payment)\nlet nextPayment=null;if(loanPayments.length>0){loanPayments.sort((a,b)=>{if(a.isOverdue&&!b.isOverdue)return-1;if(!a.isOverdue&&b.isOverdue)return 1;return a.paymentDate-b.paymentDate;});nextPayment=loanPayments[0];}// Get remaining balance from schedule (last segment's remain_balance)\nlet remainingBalance=0;if(schedule.length>0){const lastSegment=schedule[schedule.length-1];remainingBalance=parseFloat(lastSegment.remain_balance||0);}loanPaymentMap.push({loan:loan,nextPayment:nextPayment,schedule:schedule,remainingBalance:remainingBalance});}else{// No schedule data\nloanPaymentMap.push({loan:loan,nextPayment:null,schedule:[],remainingBalance:0});}}else{loanPaymentMap.push({loan:loan,nextPayment:null,schedule:[],remainingBalance:0});}}catch(e){console.error(\"Failed to load repayment schedule for loan \".concat(loan.id,\":\"),e);loanPaymentMap.push({loan:loan,nextPayment:null,schedule:[],remainingBalance:0});}}setLoanPayments(loanPaymentMap);// Find the most urgent next payment: prioritize overdue first, then closest due date\nif(allPayments.length>0){// Sort: overdue first, then by date (earliest first)\nallPayments.sort((a,b)=>{if(a.isOverdue&&!b.isOverdue)return-1;if(!a.isOverdue&&b.isOverdue)return 1;return a.paymentDate-b.paymentDate;});const next=allPayments[0];setCurrentLoan(next.loan);setNextPayment(next);// Find and store schedule for current loan to get remaining balance\n// We already fetched schedules above, find the one for current loan\nfor(const loan of activeLoans){if(loan.id===next.loan.id){try{const currentScheduleResp=await fetch(\"\".concat(apiBase,\"/echovault/v2/get-repayment-schedule?loan_id=\").concat(loan.id),{headers:{Authorization:\"Bearer \".concat(token)},mode:'cors'});if(currentScheduleResp.ok){const currentScheduleJson=await currentScheduleResp.json();if(currentScheduleJson.success&&currentScheduleJson.schedule){setCurrentLoanSchedule(currentScheduleJson.schedule);}}}catch(e){console.error('Failed to load schedule for current loan:',e);}break;}}}else if(activeLoans.length>0){// No payments found, but we have active loans - set first active loan\nsetCurrentLoan(activeLoans[0]);// Fetch schedule for current loan to get remaining balance\ntry{const currentScheduleResp=await fetch(\"\".concat(apiBase,\"/echovault/v2/get-repayment-schedule?loan_id=\").concat(activeLoans[0].id),{headers:{Authorization:\"Bearer \".concat(token)},mode:'cors'});if(currentScheduleResp.ok){const currentScheduleJson=await currentScheduleResp.json();if(currentScheduleJson.success&&currentScheduleJson.schedule){setCurrentLoanSchedule(currentScheduleJson.schedule);}}}catch(e){console.error('Failed to load schedule for current loan:',e);}}else{// No active loans, clear schedule\nsetCurrentLoanSchedule([]);}setPaymentLoading(false);}}catch(e){console.error('Failed to load loans:',e);setPaymentLoading(false);}};loadLoans();},[token,profile]);// Fetch latest news post\nuseEffect(()=>{const loadNews=async()=>{setNewsLoading(true);try{// Get the category ID for \"system-news\" slug\nconst categoryResp=await fetch('https://yourfinservices.com.au/wp-json/wp/v2/categories?slug=system-news',{mode:'cors'});let categoryId=null;if(categoryResp.ok){const categories=await categoryResp.json();if(categories&&categories.length>0){categoryId=categories[0].id;}}// Fetch latest 1 post from the external site\nconst postsUrl=categoryId?\"https://yourfinservices.com.au/wp-json/wp/v2/posts?categories=\".concat(categoryId,\"&per_page=1&_embed\"):'https://yourfinservices.com.au/wp-json/wp/v2/posts?per_page=1&_embed';const resp=await fetch(postsUrl,{mode:'cors'});if(resp.ok){const data=await resp.json();if(data&&data.length>0){setLatestNews(data[0]);}}}catch(e){console.error('Error loading news:',e);}finally{setNewsLoading(false);}};loadNews();},[]);const getCurrencyFromLoan=loan=>{var _loan$meta6;if(!loan)return'AUD';return loan.loan_currency||((_loan$meta6=loan.meta)===null||_loan$meta6===void 0?void 0:_loan$meta6.loan_currency)||'AUD';};const currency=nextPayment!==null&&nextPayment!==void 0&&nextPayment.loan?getCurrencyFromLoan(nextPayment.loan):(currentLoan===null||currentLoan===void 0?void 0:currentLoan.loan_currency)||(currentLoan===null||currentLoan===void 0?void 0:(_currentLoan$meta=currentLoan.meta)===null||_currentLoan$meta===void 0?void 0:_currentLoan$meta.loan_currency)||'AUD';const getCurrencySymbol=c=>c==='MNT'?'₮':'$';const formatDate=dateString=>{if(!dateString)return'N/A';try{const date=new Date(dateString);if(isNaN(date.getTime()))return'N/A';return date.toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});}catch(e){return'N/A';}};const getFullName=()=>{var _profile$meta2,_profile$meta3,_profile$title;if(!profile)return(user===null||user===void 0?void 0:user.username)||'Client';const firstName=profile.first_name||((_profile$meta2=profile.meta)===null||_profile$meta2===void 0?void 0:_profile$meta2.first_name)||'';const lastName=profile.last_name||((_profile$meta3=profile.meta)===null||_profile$meta3===void 0?void 0:_profile$meta3.last_name)||'';if(firstName&&lastName){return\"\".concat(firstName,\" \").concat(lastName);}return firstName||lastName||((_profile$title=profile.title)===null||_profile$title===void 0?void 0:_profile$title.rendered)||(user===null||user===void 0?void 0:user.username)||'Client';};const getStatusBadge=payment=>{if(!payment)return null;// Determine status using payment data (matching admin side logic)\nconst originalStatus=String(payment.repayment_status||'Pending').trim();// Check if payment has been made - check payment data first\nconst hasPayment=payment.total_payment&&parseFloat(payment.total_payment)>0||payment.paid_date&&payment.paid_date.trim()!==''&&payment.paid_date!=='-'||payment.paid_interest&&parseFloat(payment.paid_interest)>0||payment.paid_principles&&parseFloat(payment.paid_principles)>0||originalStatus.toLowerCase()==='paid';// ONLY 2 STATUSES (matching admin side):\n// 1. \"Paid\" (GREEN): Payment has been made\n// 2. \"Pending\" (GRAY): No payment made\nlet status='Pending';let statusConfig={bg:'bg-gray-100',text:'text-gray-800',border:'border-gray-300',icon:'○'};if(hasPayment){status='Paid';statusConfig={bg:'bg-green-100',text:'text-green-800',border:'border-green-300',icon:'✓'};}else{status='Pending';statusConfig={bg:'bg-gray-100',text:'text-gray-800',border:'border-gray-300',icon:'○'};}return/*#__PURE__*/_jsxs(\"div\",{className:\"inline-flex items-center px-4 py-2 rounded-lg border-2 \".concat(statusConfig.bg,\" \").concat(statusConfig.text,\" \").concat(statusConfig.border,\" font-bold text-sm\"),children:[/*#__PURE__*/_jsx(\"span\",{className:\"mr-2\",children:statusConfig.icon}),/*#__PURE__*/_jsx(\"span\",{children:status})]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"Dashboard\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[\"Welcome back, \",getFullName()]})]})})}),loading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Loading profile...\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-600\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8 items-stretch\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-3 flex\",children:[paymentLoading&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 w-full\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Loading payment information...\"})}),!paymentLoading&&currentLoan&&nextPayment&&/*#__PURE__*/_jsxs(\"div\",{className:\"rounded-lg border-2 p-6 w-full flex flex-col \".concat(nextPayment.isOverdue?'bg-red-50 border-red-300':'bg-white border-gray-200'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-900 mb-1\",children:\"Next Payment\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[((_currentLoan$title=currentLoan.title)===null||_currentLoan$title===void 0?void 0:_currentLoan$title.rendered)||currentLoan.loan_title||\"Loan #\".concat(currentLoan.id),loans.length>1&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 text-xs text-gray-500\",children:[\"(\",loans.length,\" active \",loans.length===1?'loan':'loans',\")\"]})]})]}),getStatusBadge(nextPayment)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600 mb-1\",children:\"Payment Date\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-lg font-semibold \".concat(nextPayment.isOverdue?'text-red-700':'text-gray-900'),children:formatDate(nextPayment.paymentDateStr)}),nextPayment.isOverdue&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-600 mt-1 font-medium\",children:\"\\u26A0 Past due date\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600 mb-1\",children:\"Total Payment Amount\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-2xl font-bold text-gray-900\",children:[getCurrencySymbol(currency),(()=>{// Calculate total payment: use total_payment if available and > 0, otherwise sum principal + interest\nconst totalPayment=parseFloat(nextPayment.total_payment||0);if(totalPayment>0){return totalPayment.toFixed(2);}// Fallback: calculate from principal + interest\nconst principal=parseFloat(nextPayment.paid_principles||nextPayment.paid_principal||0);const interest=parseFloat(nextPayment.accrued_interest||nextPayment.paid_interest||0);const calculated=principal+interest;return calculated>0?calculated.toFixed(2):'0.00';})()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600 mb-1\",children:\"Interest Amount\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-semibold text-gray-900\",children:[getCurrencySymbol(currency),parseFloat(nextPayment.accrued_interest||nextPayment.paid_interest||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[\"Principal: \",getCurrencySymbol(currency),parseFloat(nextPayment.paid_principles||nextPayment.paid_principal||0).toFixed(2)]})]})]}),nextPayment.isOverdue&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 p-4 bg-red-100 border border-red-300 rounded-lg\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-red-800\",children:\"\\u26A0 This payment is overdue. Please make payment as soon as possible to avoid additional fees.\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-auto pt-4\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate(\"/loans/\".concat(currentLoan.id)),className:\"text-blue-600 hover:text-blue-700 font-medium text-sm inline-flex items-center\",children:[\"View full loan details\",/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4 ml-1\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 5l7 7-7 7\"})})]})})]}),!paymentLoading&&currentLoan&&!nextPayment&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 w-full flex flex-col\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-start justify-between mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-900 mb-1\",children:\"Next Payment\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:((_currentLoan$title2=currentLoan.title)===null||_currentLoan$title2===void 0?void 0:_currentLoan$title2.rendered)||currentLoan.loan_title||\"Loan #\".concat(currentLoan.id)})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 flex items-center justify-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No upcoming payments found for your current loan.\"})})]}),!paymentLoading&&!currentLoan&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 w-full flex flex-col\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-start justify-between mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-900 mb-1\",children:\"Next Payment\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"No active loans\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 flex items-center justify-center py-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-8 h-8 text-gray-400\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"})})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No payment information available\"})]})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"lg:col-span-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg border border-gray-200 overflow-hidden h-full\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-4 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-bold text-gray-900\",children:\"Latest News\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/news'),className:\"text-xs text-blue-600 hover:text-blue-700 font-medium\",children:\"View all\"})]})}),newsLoading?/*#__PURE__*/_jsx(\"div\",{className:\"p-4\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Loading news...\"})}):latestNews?/*#__PURE__*/_jsx(\"div\",{className:\"cursor-pointer hover:bg-gray-50 transition-colors\",onClick:()=>{if(latestNews.link){window.open(latestNews.link,'_blank','noopener,noreferrer');}},children:((_latestNews$excerpt,_latestNews$content,_latestNews$title,_latestNews$title2)=>{// Get featured image if available\nconst getFeaturedImage=post=>{var _post$_embedded,_post$_embedded$wpFe;if(!post)return null;const embeddedMedia=(_post$_embedded=post._embedded)===null||_post$_embedded===void 0?void 0:(_post$_embedded$wpFe=_post$_embedded['wp:featuredmedia'])===null||_post$_embedded$wpFe===void 0?void 0:_post$_embedded$wpFe[0];if(embeddedMedia){var _embeddedMedia$media_;if(embeddedMedia.source_url)return embeddedMedia.source_url;if((_embeddedMedia$media_=embeddedMedia.media_details)!==null&&_embeddedMedia$media_!==void 0&&_embeddedMedia$media_.sizes){var _sizes$large,_sizes$medium_large,_sizes$medium,_sizes$full;const sizes=embeddedMedia.media_details.sizes;if((_sizes$large=sizes.large)!==null&&_sizes$large!==void 0&&_sizes$large.source_url)return sizes.large.source_url;if((_sizes$medium_large=sizes['medium_large'])!==null&&_sizes$medium_large!==void 0&&_sizes$medium_large.source_url)return sizes['medium_large'].source_url;if((_sizes$medium=sizes.medium)!==null&&_sizes$medium!==void 0&&_sizes$medium.source_url)return sizes.medium.source_url;if((_sizes$full=sizes.full)!==null&&_sizes$full!==void 0&&_sizes$full.source_url)return sizes.full.source_url;}}if(post.featured_media_url)return post.featured_media_url;return null;};const featuredImage=getFeaturedImage(latestNews);const excerpt=((_latestNews$excerpt=latestNews.excerpt)===null||_latestNews$excerpt===void 0?void 0:_latestNews$excerpt.rendered)||((_latestNews$content=latestNews.content)===null||_latestNews$content===void 0?void 0:_latestNews$content.rendered)||'';const textContent=excerpt.replace(/<[^>]*>/g,'').substring(0,100);return/*#__PURE__*/_jsxs(_Fragment,{children:[featuredImage&&/*#__PURE__*/_jsx(\"div\",{className:\"w-full h-40 overflow-hidden bg-gray-100\",children:/*#__PURE__*/_jsx(\"img\",{src:featuredImage,alt:((_latestNews$title=latestNews.title)===null||_latestNews$title===void 0?void 0:_latestNews$title.rendered)||'News image',className:\"w-full h-full object-cover\",onError:e=>{e.target.style.display='none';}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-semibold text-gray-900 mb-2 line-clamp-2\",children:((_latestNews$title2=latestNews.title)===null||_latestNews$title2===void 0?void 0:_latestNews$title2.rendered)||'News'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mb-2\",children:new Date(latestNews.date).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})}),textContent&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-600 line-clamp-3\",children:[textContent,\"...\"]})]})]});})()}):/*#__PURE__*/_jsx(\"div\",{className:\"p-4\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"No news available\"})})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-blue-100 rounded-lg\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 text-blue-600\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M4 6h16M4 10h16M4 14h16M4 18h16\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600\",children:\"Total Loans\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-gray-900\",children:loans.length})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-green-100 rounded-lg\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 text-green-600\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600\",children:\"Current Loan Balance\"}),currentLoan?/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-gray-900\",children:(()=>{// Get remaining balance from schedule if available (most accurate)\nlet remainingBalance=0;if(currentLoanSchedule&&currentLoanSchedule.length>0){// Use the last segment's remain_balance (most current)\nconst lastSegment=currentLoanSchedule[currentLoanSchedule.length-1];remainingBalance=parseFloat(lastSegment.remain_balance||0);}// Fallback to loan data fields if schedule not available\nif(remainingBalance===0){var _currentLoan$meta2,_currentLoan$meta3;remainingBalance=parseFloat(currentLoan.remaining_balance||((_currentLoan$meta2=currentLoan.meta)===null||_currentLoan$meta2===void 0?void 0:_currentLoan$meta2.remaining_balance)||((_currentLoan$meta3=currentLoan.meta)===null||_currentLoan$meta3===void 0?void 0:_currentLoan$meta3.remain_balance)||0);}return\"\".concat(getCurrencySymbol(currency)).concat(remainingBalance.toFixed(2));})()}):/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-gray-400\",children:\"No loan\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-3 rounded-lg \".concat(nextPayment!==null&&nextPayment!==void 0&&nextPayment.isOverdue?'bg-red-100':'bg-purple-100'),children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 \".concat(nextPayment!==null&&nextPayment!==void 0&&nextPayment.isOverdue?'text-red-600':'text-purple-600'),fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600\",children:\"Days Until Payment\"}),nextPayment?/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold \".concat(nextPayment.isOverdue?'text-red-600':'text-gray-900'),children:(()=>{if(!nextPayment.paymentDate)return'N/A';try{const today=new Date();today.setHours(0,0,0,0);const paymentDate=new Date(nextPayment.paymentDate);paymentDate.setHours(0,0,0,0);const diffTime=paymentDate-today;const diffDays=Math.ceil(diffTime/(1000*60*60*24));if(diffDays<0)return\"\".concat(Math.abs(diffDays),\" days overdue\");if(diffDays===0)return'Due today';return\"\".concat(diffDays,\" days\");}catch(e){return'N/A';}})()}):/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-gray-400\",children:\"No payment\"})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-900\",children:\"My Loans\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mt-1\",children:loans.length>1?'View status and next payment for all your loans':loans.length===1?'View your loan details':'You don\\'t have any loans yet'})]}),loans.length>0&&loanPayments.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\",children:loanPayments.map(_ref2=>{var _loan$meta7,_loan$meta0,_loan$title;let{loan,nextPayment:loanNextPayment,remainingBalance:loanRemainingBalance,schedule:loanSchedule}=_ref2;const loanCurrency=loan.loan_currency||((_loan$meta7=loan.meta)===null||_loan$meta7===void 0?void 0:_loan$meta7.loan_currency)||'AUD';const loanCurrencySymbol=getCurrencySymbol(loanCurrency);// Get remaining balance - prefer from schedule, fallback to loan data\nlet loanBalance=loanRemainingBalance||0;if(loanBalance===0||isNaN(loanBalance)){if(loanSchedule&&loanSchedule.length>0){// Get from last segment of schedule\nconst lastSegment=loanSchedule[loanSchedule.length-1];loanBalance=parseFloat(lastSegment.remain_balance||0);}if(loanBalance===0||isNaN(loanBalance)){var _loan$meta8,_loan$meta9;// Fallback to loan data\nloanBalance=parseFloat(loan.remaining_balance||((_loan$meta8=loan.meta)===null||_loan$meta8===void 0?void 0:_loan$meta8.remaining_balance)||((_loan$meta9=loan.meta)===null||_loan$meta9===void 0?void 0:_loan$meta9.remain_balance)||0);}}const loanStatus=((_loan$meta0=loan.meta)===null||_loan$meta0===void 0?void 0:_loan$meta0.loan_status)||loan.loan_status||'Active';// Calculate total payment for display\nconst getTotalPayment=payment=>{if(!payment)return 0;const totalPayment=parseFloat(payment.total_payment||0);if(totalPayment>0)return totalPayment;const principal=parseFloat(payment.paid_principles||payment.paid_principal||0);const interest=parseFloat(payment.accrued_interest||payment.paid_interest||0);return principal+interest;};// Calculate days until payment\nconst getDaysUntilPayment=payment=>{if(!payment||!payment.paymentDate)return'N/A';try{const today=new Date();today.setHours(0,0,0,0);const paymentDate=new Date(payment.paymentDate);paymentDate.setHours(0,0,0,0);const diffTime=paymentDate-today;const diffDays=Math.ceil(diffTime/(1000*60*60*24));if(diffDays<0)return\"\".concat(Math.abs(diffDays),\" days overdue\");if(diffDays===0)return'Due today';return\"\".concat(diffDays,\" days\");}catch(e){return'N/A';}};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg border-2 p-5 cursor-pointer transition-all hover:shadow-md \".concat(loanNextPayment!==null&&loanNextPayment!==void 0&&loanNextPayment.isOverdue?'border-red-300 bg-red-50':'border-gray-200'),onClick:()=>navigate(\"/loans/\".concat(loan.id)),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between mb-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1\",children:/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-900 mb-1\",children:((_loan$title=loan.title)===null||_loan$title===void 0?void 0:_loan$title.rendered)||loan.loan_title||\"Loan #\".concat(loan.id)})}),loanNextPayment&&getStatusBadge(loanNextPayment)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Status:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-900\",children:loanStatus})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Balance:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium text-gray-900\",children:[loanCurrencySymbol,loanBalance.toFixed(2)]})]}),loanNextPayment?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Next Payment:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium \".concat(loanNextPayment.isOverdue?'text-red-600':'text-gray-900'),children:formatDate(loanNextPayment.paymentDateStr)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Amount:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold text-gray-900\",children:[loanCurrencySymbol,getTotalPayment(loanNextPayment).toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Days:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium \".concat(loanNextPayment.isOverdue?'text-red-600':'text-gray-900'),children:getDaysUntilPayment(loanNextPayment)})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-2 text-gray-500 text-xs\",children:\"No upcoming payments\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 pt-3 border-t border-gray-200\",children:/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();navigate(\"/loans/\".concat(loan.id));},className:\"w-full text-sm text-blue-600 hover:text-blue-700 font-medium\",children:\"View Details \\u2192\"})})]},loan.id);})}):/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-8 h-8 text-gray-400\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M4 6h16M4 10h16M4 14h16M4 18h16\"})})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"No Loans\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"You don't have any loans at this time.\"})]})})]})]});}function LoansPage(_ref3){let{token}=_ref3;const{profile}=useCurrentClient(token);const[loans,setLoans]=useState([]);const[loanStatuses,setLoanStatuses]=useState({});// Store repayment status for each loan\nconst[loading,setLoading]=useState(true);const[error,setError]=useState('');const navigate=useNavigate();useEffect(()=>{if(!token||!profile)return;const load=async()=>{setLoading(true);setError('');try{const resp=await fetch(\"\".concat(apiBase,\"/wp/v2/loans?per_page=100&context=edit\"),{headers:getAuthHeaders(token),mode:'cors'});if(!resp.ok)throw new Error('Failed to load loans');const data=await resp.json();// Use comprehensive filtering function\nconst filtered=data.filter(loan=>isLoanForBorrower(loan,profile));setLoans(filtered);// Calculate repayment status for all loans based on loan end date (matching admin side logic)\nconst statusMap={};const today=new Date();today.setHours(0,0,0,0);for(const loan of filtered){var _loan$meta1;// Calculate overall repayment status based on loan end date\nlet overallStatus='Pending';const endDateStr=loan.end_date||((_loan$meta1=loan.meta)===null||_loan$meta1===void 0?void 0:_loan$meta1.end_date);if(endDateStr){try{const endDate=new Date(endDateStr);endDate.setHours(0,0,0,0);// Determine repayment status based on loan end date\n// If current date > loan end date → \"Overdue\", otherwise → \"Pending\"\nif(endDate<today){// Loan end date has passed\noverallStatus='Overdue';}else{// Loan end date hasn't passed\noverallStatus='Pending';}}catch(e){// If date parsing fails, default to Pending\noverallStatus='Pending';}}statusMap[loan.id]=overallStatus;}setLoanStatuses(statusMap);}catch(e){setError(e.message||'Failed to load loans');}finally{setLoading(false);}};load();},[token,profile]);const getRepaymentStatusBadge=status=>{// Loan-level repayment status (matching admin side):\n// 1. \"Overdue\" (RED): Loan end date has passed\n// 2. \"Pending\" (GRAY): Loan end date hasn't passed\nconst statusConfig={'Overdue':{bg:'bg-red-100',text:'text-red-800',border:'border-red-300',icon:'⚠'},'Pending':{bg:'bg-gray-100',text:'text-gray-800',border:'border-gray-300',icon:'○'}};const config=statusConfig[status]||statusConfig['Pending'];return/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center px-3 py-1 rounded-full border-2 \".concat(config.bg,\" \").concat(config.text,\" \").concat(config.border,\" font-bold text-xs\"),children:[/*#__PURE__*/_jsx(\"span\",{className:\"mr-1.5\",children:config.icon}),/*#__PURE__*/_jsx(\"span\",{children:status})]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"My Loans\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"View your active and past loans.\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>window.open('https://form.yourfinservices.com.au/loan-request/','_blank','noopener,noreferrer'),className:\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 self-start sm:self-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 6v6m0 0v6m0-6h6m-6 0H6\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"Apply a new loan\"})]})]})}),loading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Loading loans...\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-600\",children:error}),!loading&&!error&&loans.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"You do not have any loans yet.\"})}),loans.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Loan\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Total Balance\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Remaining Balance\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Loan Status\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Repayment Status\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:loans.map(loan=>{var _loan$meta10,_loan$meta11,_loan$meta12,_loan$meta13,_loan$title2,_loan$meta14;const currency=(loan===null||loan===void 0?void 0:loan.loan_currency)||(loan===null||loan===void 0?void 0:(_loan$meta10=loan.meta)===null||_loan$meta10===void 0?void 0:_loan$meta10.loan_currency)||'AUD';const getCurrencySymbol=c=>c==='MNT'?'₮':'$';const totalBalance=loan.loan_amount||((_loan$meta11=loan.meta)===null||_loan$meta11===void 0?void 0:_loan$meta11.loan_amount)||0;const remainingBalance=loan.remaining_balance||((_loan$meta12=loan.meta)===null||_loan$meta12===void 0?void 0:_loan$meta12.remaining_balance)||((_loan$meta13=loan.meta)===null||_loan$meta13===void 0?void 0:_loan$meta13.remain_balance)||totalBalance;return/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\",children:((_loan$title2=loan.title)===null||_loan$title2===void 0?void 0:_loan$title2.rendered)||loan.loan_title||\"Loan #\".concat(loan.id)}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right\",children:[getCurrencySymbol(currency),parseFloat(totalBalance).toFixed(2)]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right\",children:[getCurrencySymbol(currency),parseFloat(remainingBalance).toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:((_loan$meta14=loan.meta)===null||_loan$meta14===void 0?void 0:_loan$meta14.loan_status)||'Active'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-center\",children:getRepaymentStatusBadge(loanStatuses[loan.id]||'Pending')}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/loans/\".concat(loan.id)),className:\"text-blue-600 hover:text-blue-700 font-medium\",children:\"View details\"})})]},loan.id);})})]})})]});}function LoanDetailPage(_ref4){var _loan$meta15,_loan$title3,_loan$meta16,_loan$meta18,_loan$meta19,_loan$meta20,_loan$meta21,_loan$meta22,_loan$meta23,_loan$meta24,_loan$meta25,_loan$meta26,_loan$meta27,_loan$meta28,_coBorrower$meta,_coBorrower$meta2,_coBorrower$meta3,_coBorrower$meta4,_coBorrower$meta5,_coBorrower$meta6,_coBorrower$meta7;let{token}=_ref4;const{id}=useParams();const{profile}=useCurrentClient(token);const[activeTab,setActiveTab]=useState('Loan Details');const[loan,setLoan]=useState(null);const[coBorrower,setCoBorrower]=useState(null);const[schedule,setSchedule]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const navigate=useNavigate();useEffect(()=>{if(!token||!id||!profile)return;const load=async()=>{setLoading(true);setError('');try{var _loanJson$meta,_loanJson$meta2,_loanJson$meta3;const loanResp=await fetch(\"\".concat(apiBase,\"/wp/v2/loans/\").concat(id,\"?context=edit\"),{headers:getAuthHeaders(token),mode:'cors'});if(!loanResp.ok)throw new Error('Failed to load loan');const loanJson=await loanResp.json();// Security check: verify this loan belongs to the current user\nif(!isLoanForBorrower(loanJson,profile)){setError('You do not have permission to view this loan.');setLoading(false);return;}setLoan(loanJson);// Fetch co-borrower if exists\nconst coStatus=loanJson.co_borrower_status||((_loanJson$meta=loanJson.meta)===null||_loanJson$meta===void 0?void 0:_loanJson$meta.co_borrower_status);const coId=toId((_loanJson$meta2=loanJson.meta)===null||_loanJson$meta2===void 0?void 0:_loanJson$meta2.co_borrower_id)||toId(loanJson.co_borrower)||toId((_loanJson$meta3=loanJson.meta)===null||_loanJson$meta3===void 0?void 0:_loanJson$meta3.co_borrower);if(coStatus&&/^yes$/i.test(String(coStatus))&&coId){try{const cbResp=await fetch(\"\".concat(apiBase,\"/wp/v2/borrower-profile/\").concat(coId,\"?context=edit\"),{headers:getAuthHeaders(token),mode:'cors'});if(cbResp.ok){setCoBorrower(await cbResp.json());}}catch(e){console.error('Failed to load co-borrower:',e);}}const scheduleResp=await fetch(\"\".concat(apiBase,\"/echovault/v2/get-repayment-schedule?loan_id=\").concat(id),{headers:{Authorization:\"Bearer \".concat(token)},mode:'cors'});if(scheduleResp.ok){const scheduleJson=await scheduleResp.json();if(scheduleJson.success&&scheduleJson.schedule){setSchedule(scheduleJson.schedule);}}}catch(e){setError(e.message||'Failed to load loan');}finally{setLoading(false);}};load();},[token,id,profile]);const currency=(loan===null||loan===void 0?void 0:loan.loan_currency)||(loan===null||loan===void 0?void 0:(_loan$meta15=loan.meta)===null||_loan$meta15===void 0?void 0:_loan$meta15.loan_currency)||'AUD';const getCurrencySymbol=c=>c==='MNT'?'₮':'$';return/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/loans'),className:\"text-sm text-gray-600 hover:text-gray-900 mb-4 inline-flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4 mr-1\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M15 19l-7-7 7-7\"})}),\"Back to Loans\"]}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"Loan Details\"})]}),loading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Loading...\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-600\",children:error}),loan&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 mb-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"flex space-x-8 px-6\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setActiveTab('Loan Details'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='Loan Details'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:\"Loan Details\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setActiveTab('Repayment Schedule'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='Repayment Schedule'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:\"Repayment Schedule\"})]})})}),activeTab==='Loan Details'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loan ID\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:((_loan$title3=loan.title)===null||_loan$title3===void 0?void 0:_loan$title3.rendered)||loan.loan_title||\"Loan #\".concat(loan.id)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Status\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-1\",children:/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\",children:((_loan$meta16=loan.meta)===null||_loan$meta16===void 0?void 0:_loan$meta16.loan_status)||'Active'})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Repayment Status\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-1\",children:(_loan$meta17=>{// Calculate overall repayment status based on loan end date (matching admin side logic)\nlet overallStatus='Pending';let statusClass='bg-gray-100 text-gray-800';const endDateStr=loan.end_date||((_loan$meta17=loan.meta)===null||_loan$meta17===void 0?void 0:_loan$meta17.end_date);if(endDateStr){try{const today=new Date();today.setHours(0,0,0,0);const endDate=new Date(endDateStr);endDate.setHours(0,0,0,0);// Determine repayment status based on loan end date\n// If current date > loan end date → \"Overdue\", otherwise → \"Pending\"\nif(endDate<today){// Loan end date has passed\noverallStatus='Overdue';statusClass='bg-red-100 text-red-800';}else{// Loan end date hasn't passed\noverallStatus='Pending';statusClass='bg-gray-100 text-gray-800';}}catch(e){// If date parsing fails, default to Pending\noverallStatus='Pending';statusClass='bg-gray-100 text-gray-800';}}return/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium \".concat(statusClass),children:overallStatus});})()})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loan Amount\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:[getCurrencySymbol(currency),loan.loan_amount||((_loan$meta18=loan.meta)===null||_loan$meta18===void 0?void 0:_loan$meta18.loan_amount)||'0']})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Currency\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:currency})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loan Product\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:loan.loan_product||((_loan$meta19=loan.meta)===null||_loan$meta19===void 0?void 0:_loan$meta19.loan_product_name)||'-'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loan Interest\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:[loan.loan_interest||((_loan$meta20=loan.meta)===null||_loan$meta20===void 0?void 0:_loan$meta20.loan_interest)||'-',\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loan Term\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:loan.loan_term||(_loan$meta21=loan.meta)!==null&&_loan$meta21!==void 0&&_loan$meta21.loan_term?\"\".concat(loan.loan_term||((_loan$meta22=loan.meta)===null||_loan$meta22===void 0?void 0:_loan$meta22.loan_term),\" months\"):'-'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Repayment Method\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:loan.repayment_method||((_loan$meta23=loan.meta)===null||_loan$meta23===void 0?void 0:_loan$meta23.repayment_method)||'-'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Repayment Frequency\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:Array.isArray(loan.repayment_frequency)?loan.repayment_frequency[0]:loan.repayment_frequency||((_loan$meta24=loan.meta)===null||_loan$meta24===void 0?void 0:_loan$meta24.repayment_frequency)||'-'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loan Start Date\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:loan.start_date||((_loan$meta25=loan.meta)===null||_loan$meta25===void 0?void 0:_loan$meta25.start_date)||'-'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loan End Date\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:loan.end_date||((_loan$meta26=loan.meta)===null||_loan$meta26===void 0?void 0:_loan$meta26.end_date)||'-'})]})]})}),(loan.loan_repayment_account||((_loan$meta27=loan.meta)===null||_loan$meta27===void 0?void 0:_loan$meta27.loan_repayment_account))&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"Repayment Account Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Repayment Account\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1 break-all\",children:loan.loan_repayment_account||((_loan$meta28=loan.meta)===null||_loan$meta28===void 0?void 0:_loan$meta28.loan_repayment_account)||'-'})]})]}),coBorrower&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"Co-borrower Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"First Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:coBorrower.first_name||((_coBorrower$meta=coBorrower.meta)===null||_coBorrower$meta===void 0?void 0:_coBorrower$meta.first_name)||'-'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Last Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:coBorrower.last_name||((_coBorrower$meta2=coBorrower.meta)===null||_coBorrower$meta2===void 0?void 0:_coBorrower$meta2.last_name)||'-'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Email Address\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1 break-all\",children:coBorrower.email_address||((_coBorrower$meta3=coBorrower.meta)===null||_coBorrower$meta3===void 0?void 0:_coBorrower$meta3.email_address)||'-'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Mobile Number\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:coBorrower.mobile_number||((_coBorrower$meta4=coBorrower.meta)===null||_coBorrower$meta4===void 0?void 0:_coBorrower$meta4.mobile_number)||'-'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Date of Birth\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:coBorrower.date_of_birth||((_coBorrower$meta5=coBorrower.meta)===null||_coBorrower$meta5===void 0?void 0:_coBorrower$meta5.date_of_birth)||'-'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Document Type\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:coBorrower.document_type||((_coBorrower$meta6=coBorrower.meta)===null||_coBorrower$meta6===void 0?void 0:_coBorrower$meta6.document_type)||'-'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Document Number\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900 mt-1\",children:coBorrower.document_number||((_coBorrower$meta7=coBorrower.meta)===null||_coBorrower$meta7===void 0?void 0:_coBorrower$meta7.document_number)||'-'})]})]})]})]}),activeTab==='Repayment Schedule'&&/*#__PURE__*/_jsx(_Fragment,{children:schedule.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-4 border-b border-gray-200\",children:/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-gray-900\",children:\"Repayment Schedule\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200 text-xs\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase\",children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Start\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\",children:\"End\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Paid Date\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\",children:\"Days\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\",children:\"Start Balance\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\",children:\"Accrued Interest\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\",children:\"Paid Interest\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\",children:\"Paid Principal\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\",children:\"Total Payment\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\",children:\"Outstanding\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\",children:\"Remain Balance\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase\",children:\"Status\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:schedule.map((r,index)=>{// Determine status and badge color - match admin side logic exactly\nconst originalStatus=String(r.repayment_status||'Pending').trim();// Check if payment has been made - check payment data first\nconst hasPayment=r.total_payment&&parseFloat(r.total_payment)>0||r.paid_date&&r.paid_date.trim()!==''&&r.paid_date!=='-'||r.paid_interest&&parseFloat(r.paid_interest)>0||r.paid_principles&&parseFloat(r.paid_principles)>0||originalStatus.toLowerCase()==='paid';// ONLY 2 STATUSES (matching admin side):\n// 1. \"Paid\" (GREEN): Payment has been made\n// 2. \"Pending\" (GRAY): No payment made\nlet displayStatus='Pending';let statusClass='bg-gray-100 text-gray-800';if(hasPayment){displayStatus='Paid';statusClass='bg-green-100 text-green-800';}else{displayStatus='Pending';statusClass='bg-gray-100 text-gray-800';}return/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-center\",children:index+1}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-500\",children:r.segment_start||'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-500\",children:r.segment_end||'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-500\",children:r.paid_date||'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\",children:r.loan_days||0}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\",children:[getCurrencySymbol(currency),(r.start_balance||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\",children:[getCurrencySymbol(currency),(r.accrued_interest||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\",children:[getCurrencySymbol(currency),(r.paid_interest||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\",children:[getCurrencySymbol(currency),(r.paid_principles||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\",children:[getCurrencySymbol(currency),(r.total_payment||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\",children:[getCurrencySymbol(currency),(r.outstanding_interest||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\",children:[getCurrencySymbol(currency),(r.remain_balance||0).toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 rounded text-xs font-medium \".concat(statusClass),children:displayStatus})})]},r.id);})})]})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"No repayment schedule available.\"})})})]})]});}function ProductsPage(_ref5){let{token}=_ref5;const[products,setProducts]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');useEffect(()=>{if(!token)return;const load=async()=>{setLoading(true);setError('');try{const resp=await fetch(\"\".concat(apiBase,\"/wp/v2/loan-product?per_page=100&status=publish\"),{headers:getAuthHeaders(token),mode:'cors'});if(!resp.ok)throw new Error('Failed to load products');const data=await resp.json();setProducts(data||[]);}catch(e){setError(e.message||'Failed to load products');}finally{setLoading(false);}};load();},[token]);return/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"Active Loan Products\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Browse available loan products.\"})]})})}),loading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Loading products...\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-600\",children:error}),!loading&&!error&&products.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"No active products available.\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\",children:products.map(p=>{var _p$title;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-2\",children:p.product_name||((_p$title=p.title)===null||_p$title===void 0?void 0:_p$title.rendered)||'Loan Product'}),p.product_description&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mb-4\",children:p.product_description}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-sm\",children:[p.min_amount&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Min Amount:\"}),\" $\",p.min_amount]}),p.max_amount&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Max Amount:\"}),\" $\",p.max_amount]}),p.interest_rate&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Interest Rate:\"}),\" \",p.interest_rate,\"%\"]})]})]},p.id);})})]});}function NewsPage(){const[posts,setPosts]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');useEffect(()=>{const load=async()=>{setLoading(true);setError('');try{// First, get the category ID for \"system-news\" slug\nconst categoryResp=await fetch('https://yourfinservices.com.au/wp-json/wp/v2/categories?slug=system-news',{mode:'cors'});let categoryId=null;if(categoryResp.ok){const categories=await categoryResp.json();if(categories&&categories.length>0){categoryId=categories[0].id;}}// Fetch posts from the external site\n// If category found, filter by category, otherwise fetch all posts\nconst postsUrl=categoryId?\"https://yourfinservices.com.au/wp-json/wp/v2/posts?categories=\".concat(categoryId,\"&per_page=20&_embed\"):'https://yourfinservices.com.au/wp-json/wp/v2/posts?per_page=20&_embed';const resp=await fetch(postsUrl,{mode:'cors'});if(!resp.ok){throw new Error('Failed to load news');}const data=await resp.json();setPosts(data||[]);}catch(e){console.error('Error loading news:',e);setError(e.message||'Failed to load news');}finally{setLoading(false);}};load();},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"News\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Latest updates and announcements.\"})]})})}),loading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Loading news...\"}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-yellow-800\",children:error}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-yellow-600 mt-1\",children:\"Unable to load news from external source. Please try again later.\"})]}),!loading&&!error&&posts.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"No news articles found.\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\",children:posts.map(post=>{var _post$excerpt,_post$content,_post$title,_post$title2;// Get featured image if available - try multiple paths\nconst getFeaturedImage=post=>{var _post$_embedded2,_post$_embedded2$wpF;if(!post)return null;// Try embedded media\nconst embeddedMedia=(_post$_embedded2=post._embedded)===null||_post$_embedded2===void 0?void 0:(_post$_embedded2$wpF=_post$_embedded2['wp:featuredmedia'])===null||_post$_embedded2$wpF===void 0?void 0:_post$_embedded2$wpF[0];if(embeddedMedia){var _embeddedMedia$media_2;// Try source_url first\nif(embeddedMedia.source_url)return embeddedMedia.source_url;// Try media_details sizes\nif((_embeddedMedia$media_2=embeddedMedia.media_details)!==null&&_embeddedMedia$media_2!==void 0&&_embeddedMedia$media_2.sizes){var _sizes$large2,_sizes$medium_large2,_sizes$medium2,_sizes$full2;const sizes=embeddedMedia.media_details.sizes;// Try large, medium_large, medium, or full\nif((_sizes$large2=sizes.large)!==null&&_sizes$large2!==void 0&&_sizes$large2.source_url)return sizes.large.source_url;if((_sizes$medium_large2=sizes['medium_large'])!==null&&_sizes$medium_large2!==void 0&&_sizes$medium_large2.source_url)return sizes['medium_large'].source_url;if((_sizes$medium2=sizes.medium)!==null&&_sizes$medium2!==void 0&&_sizes$medium2.source_url)return sizes.medium.source_url;if((_sizes$full2=sizes.full)!==null&&_sizes$full2!==void 0&&_sizes$full2.source_url)return sizes.full.source_url;}}// Try direct featured_media_url\nif(post.featured_media_url)return post.featured_media_url;return null;};const featuredImage=getFeaturedImage(post);// Get excerpt or content\nconst excerpt=((_post$excerpt=post.excerpt)===null||_post$excerpt===void 0?void 0:_post$excerpt.rendered)||((_post$content=post.content)===null||_post$content===void 0?void 0:_post$content.rendered)||'';// Strip HTML tags for preview (keep first 120 chars for grid layout)\nconst textContent=excerpt.replace(/<[^>]*>/g,'').substring(0,120);return/*#__PURE__*/_jsxs(\"article\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow flex flex-col\",children:[featuredImage&&/*#__PURE__*/_jsx(\"div\",{className:\"w-full h-40 overflow-hidden bg-gray-100\",children:/*#__PURE__*/_jsx(\"img\",{src:featuredImage,alt:((_post$title=post.title)===null||_post$title===void 0?void 0:_post$title.rendered)||'News image',className:\"w-full h-full object-cover\",onError:e=>{e.target.style.display='none';}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 flex-1 flex flex-col\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-base font-semibold text-gray-900 mb-2 line-clamp-2\",children:((_post$title2=post.title)===null||_post$title2===void 0?void 0:_post$title2.rendered)||'News'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mb-2\",children:new Date(post.date).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-600 mb-3 flex-1 line-clamp-3\",children:[textContent,textContent.length>=120&&'...']}),post.link&&/*#__PURE__*/_jsxs(\"a\",{href:post.link,target:\"_blank\",rel:\"noopener noreferrer\",className:\"inline-flex items-center text-xs text-blue-600 hover:text-blue-700 font-medium mt-auto\",children:[\"Read more\",/*#__PURE__*/_jsx(\"svg\",{className:\"w-3 h-3 ml-1\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 5l7 7-7 7\"})})]})]})]},post.id);})})]});}// Avatar utility function\nfunction getAvatarByBorrowerId(borrowerIdOrBorrower){const avatarImages=['monster.svg','monster (1).svg','monster (2).svg','monster (3).svg','monster (4).svg','monster (5).svg','monster (6).svg','monster (7).svg','monster (8).svg','monster (9).svg','monster (10).svg','monster (11).svg','monster (12).svg'];let avatarFilename=null;if(typeof borrowerIdOrBorrower==='object'&&borrowerIdOrBorrower!==null){var _borrower$meta,_borrower$fields,_borrower$meta2;const borrower=borrowerIdOrBorrower;let savedAvatar=borrower.avatar||((_borrower$meta=borrower.meta)===null||_borrower$meta===void 0?void 0:_borrower$meta.avatar)||((_borrower$fields=borrower.fields)===null||_borrower$fields===void 0?void 0:_borrower$fields.avatar)||(Array.isArray(borrower.avatar)?borrower.avatar[0]:null)||(Array.isArray((_borrower$meta2=borrower.meta)===null||_borrower$meta2===void 0?void 0:_borrower$meta2.avatar)?borrower.meta.avatar[0]:null);if(savedAvatar&&typeof savedAvatar==='object'){savedAvatar=savedAvatar.name||savedAvatar.filename||savedAvatar.url||savedAvatar;}if(savedAvatar&&typeof savedAvatar==='string'&&savedAvatar.trim()){avatarFilename=savedAvatar.trim();}if(!avatarFilename){const borrowerId=borrower.id||borrower.ID;if(borrowerId){const avatarIndex=borrowerId%avatarImages.length;avatarFilename=avatarImages[avatarIndex];}}}else if(typeof borrowerIdOrBorrower==='number'){const borrowerId=borrowerIdOrBorrower;const avatarIndex=borrowerId%avatarImages.length;avatarFilename=avatarImages[avatarIndex];}if(!avatarFilename){avatarFilename=avatarImages[0];}return\"/avatars/\".concat(avatarFilename);}function LoanCalculatorPage(){return/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"Loan Calculator\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Estimate repayments and terms\"})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-12 h-12 text-gray-400\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:1.5,d:\"M7 7h10M7 11h10M9 15h6M9 19h6\"})})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold text-gray-900 mb-2\",children:\"Calculator coming soon\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 max-w-md mx-auto\",children:\"We will add repayment and term estimation here with inputs and instant results.\"})]})]});}function ProfilePage(_ref6){var _profile$meta4;let{token}=_ref6;const{profile,loading,error}=useCurrentClient(token);const[activeTab,setActiveTab]=useState('general');const field=val=>val===null||val===undefined||val===''?'-':String(val);const fullName=profile?\"\".concat(profile.first_name||'',\" \").concat(profile.last_name||'').trim()||'Unknown Client':'Unknown Client';const initials=fullName.split(' ').map(n=>n[0]).join('').toUpperCase();return/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[loading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Loading profile...\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-600\",children:error}),!loading&&!error&&!profile&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"No client profile is linked to this account yet.\"}),profile&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"img\",{src:getAvatarByBorrowerId(profile),alt:fullName,className:\"w-16 h-16 rounded-full object-cover mr-4\",onError:e=>{e.target.style.display='none';e.target.nextSibling.style.display='flex';}}),/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-xl mr-4 hidden\",children:initials}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-1\",children:fullName}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[\"ID: \",profile.id||'-']}),/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\",children:\"Active\"})]})]})]})})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"flex space-x-8 px-6\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setActiveTab('general'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='general'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:\"General Information\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setActiveTab('visa'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='visa'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:\"Visa Status\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setActiveTab('employment'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='employment'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:\"Employment\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setActiveTab('family'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='family'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:\"Family Information\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setActiveTab('bank'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='bank'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:\"Bank Details\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 text-sm text-gray-900\",children:[activeTab==='general'&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"First Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.first_name)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Last Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.last_name)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Email\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.email_address)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Borrower ID\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.borrower_id||((_profile$meta4=profile.meta)===null||_profile$meta4===void 0?void 0:_profile$meta4.borrower_id))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Date of Birth\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.date_of_birth)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Mobile Number\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.mobile_number)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Registration Number\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.registration_number)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"md:col-span-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Home Address\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium whitespace-pre-line\",children:field(profile.home_address)})]})]}),activeTab==='visa'&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Visa Type\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.visa_type)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Visa Expiry Date\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.visa_expiry_date)})]})]}),activeTab==='employment'&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Employment Status\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.employment_status)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Work Rights\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.work_rights)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Employer Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.employer_name)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Job Title\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.job_title)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Monthly Income (AUD)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.monthly_income_aud)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Employment Start Date\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.employment_start_date)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Employer Phone\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.employer_phone)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Employer Email\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.employer_email)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"md:col-span-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Employer Address\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium whitespace-pre-line\",children:field(profile.employer_address)})]})]}),activeTab==='family'&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Marital Status\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.marital_status)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Family Relationship\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.family_relationship)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Family Member Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.family_member_full_name)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Family Member Phone\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.family_member_phone)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Family Member Email\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.family_member_email)})]})]}),activeTab==='bank'&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Bank Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.bank_name)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Account Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.account_name)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"BSB Number\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.bsb_number)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-1\",children:\"Account Number\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:field(profile.account_number)})]})]})]})]})]})]});}function ClientApp(){const[token,setToken]=useState(localStorage.getItem('jwt_token'));const[user,setUser]=useState(()=>{try{const s=localStorage.getItem('user');return s?JSON.parse(s):null;}catch(_unused){return null;}});const{profile}=useCurrentClient(token);const location=useLocation();const getCurrentView=()=>{const path=location.pathname;if(path==='/'||path==='/dashboard')return'dashboard';if(path.startsWith('/loans'))return'loans';if(path==='/products')return'products';if(path==='/news')return'news';if(path==='/profile')return'profile';return'dashboard';};const handleLogout=()=>{localStorage.removeItem('jwt_token');localStorage.removeItem('user');window.location.reload();};if(!token){return/*#__PURE__*/_jsx(Login,{onLoginSuccess:(newToken,userData)=>{setToken(newToken);setUser(userData);}});}return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(Sidebar,{currentView:getCurrentView()}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 flex flex-col\",children:[/*#__PURE__*/_jsx(Header,{user:user,profile:profile,onLogout:handleLogout}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(DashboardPage,{token:token,user:user})}),/*#__PURE__*/_jsx(Route,{path:\"/dashboard\",element:/*#__PURE__*/_jsx(DashboardPage,{token:token,user:user})}),/*#__PURE__*/_jsx(Route,{path:\"/loans\",element:/*#__PURE__*/_jsx(LoansPage,{token:token})}),/*#__PURE__*/_jsx(Route,{path:\"/loans/:id\",element:/*#__PURE__*/_jsx(LoanDetailPage,{token:token})}),/*#__PURE__*/_jsx(Route,{path:\"/products\",element:/*#__PURE__*/_jsx(ProductsPage,{token:token})}),/*#__PURE__*/_jsx(Route,{path:\"/loan-calculator\",element:/*#__PURE__*/_jsx(LoanCalculatorPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/news\",element:/*#__PURE__*/_jsx(NewsPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/profile\",element:/*#__PURE__*/_jsx(ProfilePage,{token:token})})]})]})]})});}function App(){return/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsx(ClientApp,{})});}export default App;","map":{"version":3,"names":["React","useEffect","useState","BrowserRouter","Routes","Route","useNavigate","useParams","useLocation","Login","Sidebar","Header","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","apiBase","window","REACT_APP_API_URL","process","env","concat","location","origin","getAuthHeaders","token","Authorization","toId","val","undefined","String","Array","isArray","id","ID","isLoanForBorrower","loan","profile","_profile$meta","_loan$meta","_loan$meta2","_loan$meta3","_loan$fields","_loan$acf","_loan$fields2","_loan$acf2","profileId","profileEmail","email_address","meta","toString","toLowerCase","trim","borrowerId","borrower_id","borrower","borrower_profile","fields","acf","_loan$meta4","_loan$fields3","loanBorrowerEmail","borrower_email","useCurrentClient","setProfile","loading","setLoading","error","setError","cancelled","load","userEmail","stored","localStorage","getItem","parsed","JSON","parse","user_email","email","_","meResp","fetch","method","headers","mode","ok","me","json","user_email_address","Error","listResp","list","matched","length","find","b","_b$meta","_b$fields","_b$meta2","_b$fields2","be","e","message","DashboardPage","_ref","_currentLoan$meta","_currentLoan$title","_currentLoan$title2","user","loans","setLoans","currentLoan","setCurrentLoan","nextPayment","setNextPayment","loanPayments","setLoanPayments","currentLoanSchedule","setCurrentLoanSchedule","paymentLoading","setPaymentLoading","latestNews","setLatestNews","newsLoading","setNewsLoading","navigate","loadLoans","resp","data","filtered","filter","activeLoans","_loan$meta5","status","loan_status","test","push","allPayments","loanPaymentMap","scheduleResp","scheduleJson","success","schedule","today","Date","setHours","forEach","r","repayment_status","paymentDateStr","segment_end","repayment_date","end_date","paymentDate","isOverdue","paymentInfo","_objectSpread","console","sort","a","remainingBalance","lastSegment","parseFloat","remain_balance","next","currentScheduleResp","currentScheduleJson","loadNews","categoryResp","categoryId","categories","postsUrl","getCurrencyFromLoan","_loan$meta6","loan_currency","currency","getCurrencySymbol","c","formatDate","dateString","date","isNaN","getTime","toLocaleDateString","year","month","day","getFullName","_profile$meta2","_profile$meta3","_profile$title","username","firstName","first_name","lastName","last_name","title","rendered","getStatusBadge","payment","originalStatus","hasPayment","total_payment","paid_date","paid_interest","paid_principles","statusConfig","bg","text","border","icon","className","children","loan_title","totalPayment","toFixed","principal","paid_principal","interest","accrued_interest","calculated","onClick","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","link","open","_latestNews$excerpt","_latestNews$content","_latestNews$title","_latestNews$title2","getFeaturedImage","post","_post$_embedded","_post$_embedded$wpFe","embeddedMedia","_embedded","_embeddedMedia$media_","source_url","media_details","sizes","_sizes$large","_sizes$medium_large","_sizes$medium","_sizes$full","large","medium","full","featured_media_url","featuredImage","excerpt","content","textContent","replace","substring","src","alt","onError","target","style","display","_currentLoan$meta2","_currentLoan$meta3","remaining_balance","diffTime","diffDays","Math","ceil","abs","map","_ref2","_loan$meta7","_loan$meta0","_loan$title","loanNextPayment","loanRemainingBalance","loanSchedule","loanCurrency","loanCurrencySymbol","loanBalance","_loan$meta8","_loan$meta9","loanStatus","getTotalPayment","getDaysUntilPayment","stopPropagation","LoansPage","_ref3","loanStatuses","setLoanStatuses","statusMap","_loan$meta1","overallStatus","endDateStr","endDate","getRepaymentStatusBadge","config","_loan$meta10","_loan$meta11","_loan$meta12","_loan$meta13","_loan$title2","_loan$meta14","totalBalance","loan_amount","LoanDetailPage","_ref4","_loan$meta15","_loan$title3","_loan$meta16","_loan$meta18","_loan$meta19","_loan$meta20","_loan$meta21","_loan$meta22","_loan$meta23","_loan$meta24","_loan$meta25","_loan$meta26","_loan$meta27","_loan$meta28","_coBorrower$meta","_coBorrower$meta2","_coBorrower$meta3","_coBorrower$meta4","_coBorrower$meta5","_coBorrower$meta6","_coBorrower$meta7","activeTab","setActiveTab","setLoan","coBorrower","setCoBorrower","setSchedule","_loanJson$meta","_loanJson$meta2","_loanJson$meta3","loanResp","loanJson","coStatus","co_borrower_status","coId","co_borrower_id","co_borrower","cbResp","type","_loan$meta17","statusClass","loan_product","loan_product_name","loan_interest","loan_term","repayment_method","repayment_frequency","start_date","loan_repayment_account","mobile_number","date_of_birth","document_type","document_number","index","displayStatus","segment_start","loan_days","start_balance","outstanding_interest","ProductsPage","_ref5","products","setProducts","p","_p$title","product_name","product_description","min_amount","max_amount","interest_rate","NewsPage","posts","setPosts","_post$excerpt","_post$content","_post$title","_post$title2","_post$_embedded2","_post$_embedded2$wpF","_embeddedMedia$media_2","_sizes$large2","_sizes$medium_large2","_sizes$medium2","_sizes$full2","href","rel","getAvatarByBorrowerId","borrowerIdOrBorrower","avatarImages","avatarFilename","_borrower$meta","_borrower$fields","_borrower$meta2","savedAvatar","avatar","name","filename","url","avatarIndex","LoanCalculatorPage","ProfilePage","_ref6","_profile$meta4","field","fullName","initials","split","n","join","toUpperCase","nextSibling","registration_number","home_address","visa_type","visa_expiry_date","employment_status","work_rights","employer_name","job_title","monthly_income_aud","employment_start_date","employer_phone","employer_email","employer_address","marital_status","family_relationship","family_member_full_name","family_member_phone","family_member_email","bank_name","account_name","bsb_number","account_number","ClientApp","setToken","setUser","s","_unused","getCurrentView","path","pathname","startsWith","handleLogout","removeItem","reload","onLoginSuccess","newToken","userData","currentView","onLogout","element","App"],"sources":["/Volumes/Main Data/EchoVault LMS/EchoVault v1/echovault-user-frontend/src/App.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport {\n  BrowserRouter,\n  Routes,\n  Route,\n  useNavigate,\n  useParams,\n  useLocation\n} from 'react-router-dom';\nimport Login from './Login';\nimport Sidebar from './Sidebar';\nimport Header from './Header';\nimport './App.css';\nimport './styles.css';\n\nconst apiBase =\n  (typeof window !== 'undefined' && window.REACT_APP_API_URL) ||\n  process.env.REACT_APP_API_URL ||\n  `${window.location.origin}/wp-json`;\n\nfunction getAuthHeaders(token) {\n  return {\n    'Content-Type': 'application/json',\n    Authorization: `Bearer ${token}`\n  };\n}\n\n// Helper function to extract ID from various formats (matching admin side logic)\nconst toId = (val) => {\n  if (val === null || val === undefined) return '';\n  if (typeof val === 'number' || typeof val === 'string') return String(val);\n  if (Array.isArray(val)) return toId(val[0]);\n  if (typeof val === 'object') {\n    if ('id' in val) return String(val.id);\n    if ('ID' in val) return String(val.ID);\n  }\n  return '';\n};\n\n// Helper function to check if a loan belongs to a borrower profile\nconst isLoanForBorrower = (loan, profile) => {\n  if (!loan || !profile) return false;\n  \n  const profileId = String(profile.id);\n  const profileEmail = (profile.email_address || profile.meta?.email_address || '').toString().toLowerCase().trim();\n  \n  // Try multiple ways to extract borrower ID from loan (matching admin side logic)\n  let borrowerId = toId(loan.meta?.borrower_id) \n    || toId(loan.borrower) \n    || toId(loan.meta?.borrower) \n    || toId(loan.meta?.borrower_profile)\n    || toId(loan.fields?.borrower_id) \n    || toId(loan.acf?.borrower_id)\n    || toId(loan.fields?.borrower)\n    || toId(loan.acf?.borrower);\n  \n  // Check if borrower ID matches\n  if (borrowerId && String(borrowerId) === profileId) {\n    return true;\n  }\n  \n  // Fallback: check by email if available\n  if (profileEmail) {\n    const loanBorrowerEmail = (loan.meta?.borrower_email || loan.fields?.borrower_email || '').toString().toLowerCase().trim();\n    if (loanBorrowerEmail && loanBorrowerEmail === profileEmail) {\n      return true;\n    }\n  }\n  \n  return false;\n};\n\nfunction useCurrentClient(token) {\n  const [profile, setProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    if (!token) return;\n    let cancelled = false;\n\n    const load = async () => {\n      setLoading(true);\n      setError('');\n      try {\n        // 1) Get email from locally stored user (set at login)\n        let userEmail = '';\n        try {\n          const stored = localStorage.getItem('user');\n          if (stored) {\n            const parsed = JSON.parse(stored);\n            userEmail =\n              (parsed.user_email || parsed.email || '')\n                .toString()\n                .toLowerCase()\n                .trim();\n          }\n        } catch (_) {}\n\n        // 2) Fallback to /users/me only if we couldn't get it from localStorage\n        if (!userEmail) {\n          const meResp = await fetch(`${apiBase}/wp/v2/users/me`, {\n            method: 'GET',\n            headers: {\n              Authorization: `Bearer ${token}`,\n              'Content-Type': 'application/json',\n            },\n            mode: 'cors',\n          });\n\n          if (meResp.ok) {\n            const me = await meResp.json();\n            userEmail = (\n              me.email ||\n              me.user_email ||\n              me.user_email_address ||\n              ''\n            )\n              .toString()\n              .toLowerCase()\n              .trim();\n          }\n        }\n\n        if (!userEmail) {\n          throw new Error('Current user email not found');\n        }\n\n        // 2) Load all borrowers visible to this token\n        const listResp = await fetch(\n          `${apiBase}/wp/v2/borrower-profile?per_page=100&context=edit`,\n          { headers: getAuthHeaders(token), mode: 'cors' }\n        );\n\n        if (!listResp.ok) {\n          throw new Error('Failed to load borrower profiles');\n        }\n\n        const list = await listResp.json();\n\n        let matched = null;\n        if (Array.isArray(list) && list.length) {\n          matched =\n            list.find((b) => {\n              const be = (\n                b.email_address ||\n                b.email ||\n                b.meta?.email_address ||\n                b.fields?.email_address ||\n                b.meta?.borrower_email ||\n                b.fields?.borrower_email ||\n                ''\n              )\n                .toString()\n                .toLowerCase()\n                .trim();\n              return be && be === userEmail;\n            }) || null;\n        }\n\n        if (!matched) {\n          throw new Error('No borrower profile found for this account');\n        }\n\n        if (!cancelled) {\n          setProfile(matched);\n        }\n      } catch (e) {\n        if (!cancelled) {\n          setError(e.message || 'Failed to load profile');\n          setProfile(null);\n        }\n      } finally {\n        if (!cancelled) {\n          setLoading(false);\n        }\n      }\n    };\n\n    load();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [token]);\n\n  return { profile, loading, error };\n}\n\nfunction DashboardPage({ token, user }) {\n  const { profile, loading, error } = useCurrentClient(token);\n  const [loans, setLoans] = useState([]);\n  const [currentLoan, setCurrentLoan] = useState(null);\n  const [nextPayment, setNextPayment] = useState(null);\n  const [loanPayments, setLoanPayments] = useState([]); // Store next payment for each loan\n  const [currentLoanSchedule, setCurrentLoanSchedule] = useState([]); // Store schedule for current loan\n  const [paymentLoading, setPaymentLoading] = useState(false);\n  const [latestNews, setLatestNews] = useState(null);\n  const [newsLoading, setNewsLoading] = useState(false);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (!token || !profile) return;\n    const loadLoans = async () => {\n      try {\n        const resp = await fetch(\n          `${apiBase}/wp/v2/loans?per_page=100&context=edit`,\n          { headers: getAuthHeaders(token), mode: 'cors' }\n        );\n        if (!resp.ok) throw new Error('Failed to load loans');\n        const data = await resp.json();\n        // Use comprehensive filtering function\n        const filtered = data.filter((loan) => isLoanForBorrower(loan, profile));\n        setLoans(filtered);\n        \n        // Get active loans\n        const activeLoans = filtered.filter(loan => {\n          const status = loan.meta?.loan_status || loan.loan_status || '';\n          return status && !/^(closed|completed|cancelled)$/i.test(status);\n        });\n        \n        if (activeLoans.length === 0 && filtered.length > 0) {\n          // If no active loans, use first loan\n          activeLoans.push(filtered[0]);\n        }\n        \n        if (activeLoans.length > 0) {\n          setPaymentLoading(true);\n          \n          // Fetch repayment schedules for all active loans\n          const allPayments = [];\n          const loanPaymentMap = []; // Store next payment and schedule for each loan\n          \n          for (const loan of activeLoans) {\n            try {\n              const scheduleResp = await fetch(\n                `${apiBase}/echovault/v2/get-repayment-schedule?loan_id=${loan.id}`,\n                { headers: { Authorization: `Bearer ${token}` }, mode: 'cors' }\n              );\n              if (scheduleResp.ok) {\n                const scheduleJson = await scheduleResp.json();\n                if (scheduleJson.success && scheduleJson.schedule && Array.isArray(scheduleJson.schedule)) {\n                  const schedule = scheduleJson.schedule;\n                  const today = new Date();\n                  today.setHours(0, 0, 0, 0);\n                  \n                  const loanPayments = [];\n                  \n                  // Find all unpaid payments for this loan\n                  schedule.forEach(r => {\n                    const status = (r.repayment_status || '').toLowerCase();\n                    if (status !== 'paid') {\n                      // Use segment_end as payment date (fallback to repayment_date if available)\n                      const paymentDateStr = r.segment_end || r.repayment_date || r.end_date;\n                      if (paymentDateStr) {\n                        try {\n                          const paymentDate = new Date(paymentDateStr);\n                          paymentDate.setHours(0, 0, 0, 0);\n                          const isOverdue = paymentDate < today;\n                          \n                          const paymentInfo = {\n                            ...r,\n                            loan: loan,\n                            paymentDate: paymentDate,\n                            paymentDateStr: paymentDateStr,\n                            isOverdue\n                          };\n                          \n                          allPayments.push(paymentInfo);\n                          loanPayments.push(paymentInfo);\n      } catch (e) {\n                          console.error('Error parsing date:', paymentDateStr, e);\n                        }\n                      }\n                    }\n                  });\n                  \n                  // Find next payment for this loan (earliest unpaid payment)\n                  let nextPayment = null;\n                  if (loanPayments.length > 0) {\n                    loanPayments.sort((a, b) => {\n                      if (a.isOverdue && !b.isOverdue) return -1;\n                      if (!a.isOverdue && b.isOverdue) return 1;\n                      return a.paymentDate - b.paymentDate;\n                    });\n                    nextPayment = loanPayments[0];\n                  }\n                  \n                  // Get remaining balance from schedule (last segment's remain_balance)\n                  let remainingBalance = 0;\n                  if (schedule.length > 0) {\n                    const lastSegment = schedule[schedule.length - 1];\n                    remainingBalance = parseFloat(lastSegment.remain_balance || 0);\n                  }\n                  \n                  loanPaymentMap.push({\n                    loan: loan,\n                    nextPayment: nextPayment,\n                    schedule: schedule,\n                    remainingBalance: remainingBalance\n                  });\n                } else {\n                  // No schedule data\n                  loanPaymentMap.push({\n                    loan: loan,\n                    nextPayment: null,\n                    schedule: [],\n                    remainingBalance: 0\n                  });\n                }\n              } else {\n                loanPaymentMap.push({\n                  loan: loan,\n                  nextPayment: null,\n                  schedule: [],\n                  remainingBalance: 0\n                });\n              }\n            } catch (e) {\n              console.error(`Failed to load repayment schedule for loan ${loan.id}:`, e);\n              loanPaymentMap.push({\n                loan: loan,\n                nextPayment: null,\n                schedule: [],\n                remainingBalance: 0\n              });\n            }\n          }\n          \n          setLoanPayments(loanPaymentMap);\n          \n          // Find the most urgent next payment: prioritize overdue first, then closest due date\n          if (allPayments.length > 0) {\n            // Sort: overdue first, then by date (earliest first)\n            allPayments.sort((a, b) => {\n              if (a.isOverdue && !b.isOverdue) return -1;\n              if (!a.isOverdue && b.isOverdue) return 1;\n              return a.paymentDate - b.paymentDate;\n            });\n            \n            const next = allPayments[0];\n            setCurrentLoan(next.loan);\n            setNextPayment(next);\n            \n            // Find and store schedule for current loan to get remaining balance\n            // We already fetched schedules above, find the one for current loan\n            for (const loan of activeLoans) {\n              if (loan.id === next.loan.id) {\n                try {\n                  const currentScheduleResp = await fetch(\n                    `${apiBase}/echovault/v2/get-repayment-schedule?loan_id=${loan.id}`,\n                    { headers: { Authorization: `Bearer ${token}` }, mode: 'cors' }\n                  );\n                  if (currentScheduleResp.ok) {\n                    const currentScheduleJson = await currentScheduleResp.json();\n                    if (currentScheduleJson.success && currentScheduleJson.schedule) {\n                      setCurrentLoanSchedule(currentScheduleJson.schedule);\n                    }\n                  }\n                } catch (e) {\n                  console.error('Failed to load schedule for current loan:', e);\n                }\n                break;\n              }\n            }\n          } else if (activeLoans.length > 0) {\n            // No payments found, but we have active loans - set first active loan\n            setCurrentLoan(activeLoans[0]);\n            \n            // Fetch schedule for current loan to get remaining balance\n            try {\n              const currentScheduleResp = await fetch(\n                `${apiBase}/echovault/v2/get-repayment-schedule?loan_id=${activeLoans[0].id}`,\n                { headers: { Authorization: `Bearer ${token}` }, mode: 'cors' }\n              );\n              if (currentScheduleResp.ok) {\n                const currentScheduleJson = await currentScheduleResp.json();\n                if (currentScheduleJson.success && currentScheduleJson.schedule) {\n                  setCurrentLoanSchedule(currentScheduleJson.schedule);\n                }\n              }\n            } catch (e) {\n              console.error('Failed to load schedule for current loan:', e);\n            }\n          } else {\n            // No active loans, clear schedule\n            setCurrentLoanSchedule([]);\n          }\n          \n          setPaymentLoading(false);\n        }\n      } catch (e) {\n        console.error('Failed to load loans:', e);\n        setPaymentLoading(false);\n      }\n    };\n    loadLoans();\n  }, [token, profile]);\n\n  // Fetch latest news post\n  useEffect(() => {\n    const loadNews = async () => {\n      setNewsLoading(true);\n      try {\n        // Get the category ID for \"system-news\" slug\n        const categoryResp = await fetch(\n          'https://yourfinservices.com.au/wp-json/wp/v2/categories?slug=system-news',\n          { mode: 'cors' }\n        );\n        \n        let categoryId = null;\n        if (categoryResp.ok) {\n          const categories = await categoryResp.json();\n          if (categories && categories.length > 0) {\n            categoryId = categories[0].id;\n          }\n        }\n        \n        // Fetch latest 1 post from the external site\n        const postsUrl = categoryId\n          ? `https://yourfinservices.com.au/wp-json/wp/v2/posts?categories=${categoryId}&per_page=1&_embed`\n          : 'https://yourfinservices.com.au/wp-json/wp/v2/posts?per_page=1&_embed';\n        \n        const resp = await fetch(postsUrl, {\n          mode: 'cors'\n        });\n        \n        if (resp.ok) {\n          const data = await resp.json();\n          if (data && data.length > 0) {\n            setLatestNews(data[0]);\n          }\n        }\n      } catch (e) {\n        console.error('Error loading news:', e);\n      } finally {\n        setNewsLoading(false);\n      }\n    };\n    loadNews();\n  }, []);\n\n  const getCurrencyFromLoan = (loan) => {\n    if (!loan) return 'AUD';\n    return loan.loan_currency || loan.meta?.loan_currency || 'AUD';\n  };\n  \n  const currency = nextPayment?.loan \n    ? getCurrencyFromLoan(nextPayment.loan)\n    : (currentLoan?.loan_currency || currentLoan?.meta?.loan_currency || 'AUD');\n  const getCurrencySymbol = (c) => (c === 'MNT' ? '₮' : '$');\n\n  const formatDate = (dateString) => {\n    if (!dateString) return 'N/A';\n    try {\n      const date = new Date(dateString);\n      if (isNaN(date.getTime())) return 'N/A';\n      return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });\n    } catch (e) {\n      return 'N/A';\n    }\n  };\n  \n  const getFullName = () => {\n    if (!profile) return user?.username || 'Client';\n    const firstName = profile.first_name || profile.meta?.first_name || '';\n    const lastName = profile.last_name || profile.meta?.last_name || '';\n    if (firstName && lastName) {\n      return `${firstName} ${lastName}`;\n    }\n    return firstName || lastName || profile.title?.rendered || user?.username || 'Client';\n  };\n\n  const getStatusBadge = (payment) => {\n    if (!payment) return null;\n    \n    // Determine status using payment data (matching admin side logic)\n    const originalStatus = String(payment.repayment_status || 'Pending').trim();\n    \n    // Check if payment has been made - check payment data first\n    const hasPayment = (payment.total_payment && parseFloat(payment.total_payment) > 0) \n      || (payment.paid_date && payment.paid_date.trim() !== '' && payment.paid_date !== '-')\n      || (payment.paid_interest && parseFloat(payment.paid_interest) > 0)\n      || (payment.paid_principles && parseFloat(payment.paid_principles) > 0)\n      || (originalStatus.toLowerCase() === 'paid');\n    \n    // ONLY 2 STATUSES (matching admin side):\n    // 1. \"Paid\" (GREEN): Payment has been made\n    // 2. \"Pending\" (GRAY): No payment made\n    let status = 'Pending';\n    let statusConfig = { bg: 'bg-gray-100', text: 'text-gray-800', border: 'border-gray-300', icon: '○' };\n    \n    if (hasPayment) {\n      status = 'Paid';\n      statusConfig = { bg: 'bg-green-100', text: 'text-green-800', border: 'border-green-300', icon: '✓' };\n    } else {\n      status = 'Pending';\n      statusConfig = { bg: 'bg-gray-100', text: 'text-gray-800', border: 'border-gray-300', icon: '○' };\n    }\n\n  return (\n      <div className={`inline-flex items-center px-4 py-2 rounded-lg border-2 ${statusConfig.bg} ${statusConfig.text} ${statusConfig.border} font-bold text-sm`}>\n        <span className=\"mr-2\">{statusConfig.icon}</span>\n        <span>{status}</span>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-8\">\n        <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\">\n      <div>\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Dashboard</h1>\n            <p className=\"text-gray-600\">\n              Welcome back, {getFullName()}\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {loading && <p className=\"text-sm text-gray-500\">Loading profile...</p>}\n      {error && <p className=\"text-sm text-red-600\">{error}</p>}\n\n      {/* Next Payment and News Section - Side by Side */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8 items-stretch\">\n        {/* Next Payment Section - 3/4 width */}\n        <div className=\"lg:col-span-3 flex\">\n          {paymentLoading && (\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 w-full\">\n              <p className=\"text-sm text-gray-500\">Loading payment information...</p>\n            </div>\n          )}\n          \n          {!paymentLoading && currentLoan && nextPayment && (\n            <div className={`rounded-lg border-2 p-6 w-full flex flex-col ${\n              nextPayment.isOverdue \n                ? 'bg-red-50 border-red-300' \n                : 'bg-white border-gray-200'\n            }`}>\n          <div className=\"flex items-start justify-between mb-4\">\n            <div>\n              <h2 className=\"text-xl font-bold text-gray-900 mb-1\">Next Payment</h2>\n              <p className=\"text-sm text-gray-600\">\n                {currentLoan.title?.rendered || currentLoan.loan_title || `Loan #${currentLoan.id}`}\n                {loans.length > 1 && (\n                  <span className=\"ml-2 text-xs text-gray-500\">\n                    ({loans.length} active {loans.length === 1 ? 'loan' : 'loans'})\n                  </span>\n                )}\n              </p>\n        </div>\n            {getStatusBadge(nextPayment)}\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600 mb-1\">Payment Date</p>\n              <p className={`text-lg font-semibold ${\n                nextPayment.isOverdue ? 'text-red-700' : 'text-gray-900'\n              }`}>\n                {formatDate(nextPayment.paymentDateStr)}\n              </p>\n              {nextPayment.isOverdue && (\n                <p className=\"text-xs text-red-600 mt-1 font-medium\">⚠ Past due date</p>\n              )}\n            </div>\n            \n            <div>\n              <p className=\"text-sm font-medium text-gray-600 mb-1\">Total Payment Amount</p>\n              <p className=\"text-2xl font-bold text-gray-900\">\n                {getCurrencySymbol(currency)}{(() => {\n                  // Calculate total payment: use total_payment if available and > 0, otherwise sum principal + interest\n                  const totalPayment = parseFloat(nextPayment.total_payment || 0);\n                  if (totalPayment > 0) {\n                    return totalPayment.toFixed(2);\n                  }\n                  // Fallback: calculate from principal + interest\n                  const principal = parseFloat(nextPayment.paid_principles || nextPayment.paid_principal || 0);\n                  const interest = parseFloat(nextPayment.accrued_interest || nextPayment.paid_interest || 0);\n                  const calculated = principal + interest;\n                  return calculated > 0 ? calculated.toFixed(2) : '0.00';\n                })()}\n              </p>\n            </div>\n            \n            <div>\n              <p className=\"text-sm font-medium text-gray-600 mb-1\">Interest Amount</p>\n              <p className=\"text-lg font-semibold text-gray-900\">\n                {getCurrencySymbol(currency)}{parseFloat(nextPayment.accrued_interest || nextPayment.paid_interest || 0).toFixed(2)}\n              </p>\n              <p className=\"text-xs text-gray-500 mt-1\">\n                Principal: {getCurrencySymbol(currency)}{parseFloat(nextPayment.paid_principles || nextPayment.paid_principal || 0).toFixed(2)}\n              </p>\n            </div>\n          </div>\n          \n          {nextPayment.isOverdue && (\n            <div className=\"mt-4 p-4 bg-red-100 border border-red-300 rounded-lg\">\n              <p className=\"text-sm font-medium text-red-800\">\n                ⚠ This payment is overdue. Please make payment as soon as possible to avoid additional fees.\n              </p>\n            </div>\n          )}\n          \n          <div className=\"mt-auto pt-4\">\n            <button\n              onClick={() => navigate(`/loans/${currentLoan.id}`)}\n              className=\"text-blue-600 hover:text-blue-700 font-medium text-sm inline-flex items-center\"\n            >\n              View full loan details\n              <svg className=\"w-4 h-4 ml-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n              </svg>\n            </button>\n        </div>\n      </div>\n          )}\n          \n          {!paymentLoading && currentLoan && !nextPayment && (\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 w-full flex flex-col\">\n              <div className=\"flex items-start justify-between mb-4\">\n                <div>\n                  <h2 className=\"text-xl font-bold text-gray-900 mb-1\">Next Payment</h2>\n                  <p className=\"text-sm text-gray-600\">\n                    {currentLoan.title?.rendered || currentLoan.loan_title || `Loan #${currentLoan.id}`}\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex-1 flex items-center justify-center py-8\">\n                <p className=\"text-gray-500\">No upcoming payments found for your current loan.</p>\n              </div>\n            </div>\n          )}\n          \n          {!paymentLoading && !currentLoan && (\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 w-full flex flex-col\">\n              <div className=\"flex items-start justify-between mb-4\">\n                <div>\n                  <h2 className=\"text-xl font-bold text-gray-900 mb-1\">Next Payment</h2>\n                  <p className=\"text-sm text-gray-600\">No active loans</p>\n                </div>\n              </div>\n              <div className=\"flex-1 flex items-center justify-center py-8\">\n                <div className=\"text-center\">\n                  <div className=\"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                    <svg className=\"w-8 h-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                    </svg>\n                  </div>\n                  <p className=\"text-gray-500\">No payment information available</p>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Latest News Card - 1/4 width */}\n        <div className=\"lg:col-span-1\">\n          <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden h-full\">\n            <div className=\"p-4 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <h2 className=\"text-lg font-bold text-gray-900\">Latest News</h2>\n                <button\n                  onClick={() => navigate('/news')}\n                  className=\"text-xs text-blue-600 hover:text-blue-700 font-medium\"\n                >\n                  View all\n                </button>\n              </div>\n            </div>\n            \n            {newsLoading ? (\n              <div className=\"p-4\">\n                <p className=\"text-xs text-gray-500\">Loading news...</p>\n              </div>\n            ) : latestNews ? (\n              <div \n                className=\"cursor-pointer hover:bg-gray-50 transition-colors\"\n                onClick={() => {\n                  if (latestNews.link) {\n                    window.open(latestNews.link, '_blank', 'noopener,noreferrer');\n                  }\n                }}\n              >\n                {(() => {\n                  // Get featured image if available\n                  const getFeaturedImage = (post) => {\n                    if (!post) return null;\n                    \n                    const embeddedMedia = post._embedded?.['wp:featuredmedia']?.[0];\n                    if (embeddedMedia) {\n                      if (embeddedMedia.source_url) return embeddedMedia.source_url;\n                      if (embeddedMedia.media_details?.sizes) {\n                        const sizes = embeddedMedia.media_details.sizes;\n                        if (sizes.large?.source_url) return sizes.large.source_url;\n                        if (sizes['medium_large']?.source_url) return sizes['medium_large'].source_url;\n                        if (sizes.medium?.source_url) return sizes.medium.source_url;\n                        if (sizes.full?.source_url) return sizes.full.source_url;\n                      }\n                    }\n                    if (post.featured_media_url) return post.featured_media_url;\n                    return null;\n                  };\n                  \n                  const featuredImage = getFeaturedImage(latestNews);\n                  const excerpt = latestNews.excerpt?.rendered || latestNews.content?.rendered || '';\n                  const textContent = excerpt.replace(/<[^>]*>/g, '').substring(0, 100);\n                  \n                  return (\n                    <>\n                      {featuredImage && (\n                        <div className=\"w-full h-40 overflow-hidden bg-gray-100\">\n                          <img \n                            src={featuredImage} \n                            alt={latestNews.title?.rendered || 'News image'}\n                            className=\"w-full h-full object-cover\"\n                            onError={(e) => {\n                              e.target.style.display = 'none';\n                            }}\n                          />\n                        </div>\n                      )}\n                      <div className=\"p-4\">\n                        <h3 className=\"text-sm font-semibold text-gray-900 mb-2 line-clamp-2\">\n                          {latestNews.title?.rendered || 'News'}\n                        </h3>\n                        <p className=\"text-xs text-gray-500 mb-2\">\n                          {new Date(latestNews.date).toLocaleDateString('en-US', { \n                            month: 'short', \n                            day: 'numeric',\n                            year: 'numeric'\n                          })}\n                        </p>\n                        {textContent && (\n                          <p className=\"text-xs text-gray-600 line-clamp-3\">\n                            {textContent}...\n                          </p>\n                        )}\n                      </div>\n                    </>\n                  );\n                })()}\n              </div>\n            ) : (\n              <div className=\"p-4\">\n                <p className=\"text-xs text-gray-500\">No news available</p>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n          <div className=\"flex items-center\">\n            <div className=\"p-3 bg-blue-100 rounded-lg\">\n              <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 10h16M4 14h16M4 18h16\" />\n              </svg>\n            </div>\n            <div className=\"ml-4\">\n              <p className=\"text-sm font-medium text-gray-600\">Total Loans</p>\n              <p className=\"text-2xl font-bold text-gray-900\">{loans.length}</p>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n          <div className=\"flex items-center\">\n            <div className=\"p-3 bg-green-100 rounded-lg\">\n              <svg className=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n              </svg>\n            </div>\n            <div className=\"ml-4\">\n              <p className=\"text-sm font-medium text-gray-600\">Current Loan Balance</p>\n              {currentLoan ? (\n                <p className=\"text-2xl font-bold text-gray-900\">\n                  {(() => {\n                    // Get remaining balance from schedule if available (most accurate)\n                    let remainingBalance = 0;\n                    if (currentLoanSchedule && currentLoanSchedule.length > 0) {\n                      // Use the last segment's remain_balance (most current)\n                      const lastSegment = currentLoanSchedule[currentLoanSchedule.length - 1];\n                      remainingBalance = parseFloat(lastSegment.remain_balance || 0);\n                    }\n                    \n                    // Fallback to loan data fields if schedule not available\n                    if (remainingBalance === 0) {\n                      remainingBalance = parseFloat(\n                        currentLoan.remaining_balance || \n                        currentLoan.meta?.remaining_balance || \n                        currentLoan.meta?.remain_balance || \n                        0\n                      );\n                    }\n                    \n                    return `${getCurrencySymbol(currency)}${remainingBalance.toFixed(2)}`;\n                  })()}\n                </p>\n              ) : (\n                <p className=\"text-2xl font-bold text-gray-400\">No loan</p>\n              )}\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n          <div className=\"flex items-center\">\n            <div className={`p-3 rounded-lg ${\n              nextPayment?.isOverdue ? 'bg-red-100' : 'bg-purple-100'\n            }`}>\n              <svg className={`w-6 h-6 ${nextPayment?.isOverdue ? 'text-red-600' : 'text-purple-600'}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n              </svg>\n            </div>\n            <div className=\"ml-4\">\n              <p className=\"text-sm font-medium text-gray-600\">Days Until Payment</p>\n              {nextPayment ? (\n                <p className={`text-2xl font-bold ${\n                  nextPayment.isOverdue ? 'text-red-600' : 'text-gray-900'\n                }`}>\n                  {(() => {\n                    if (!nextPayment.paymentDate) return 'N/A';\n                    try {\n                      const today = new Date();\n                      today.setHours(0, 0, 0, 0);\n                      const paymentDate = new Date(nextPayment.paymentDate);\n                      paymentDate.setHours(0, 0, 0, 0);\n                      const diffTime = paymentDate - today;\n                      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n                      if (diffDays < 0) return `${Math.abs(diffDays)} days overdue`;\n                      if (diffDays === 0) return 'Due today';\n                      return `${diffDays} days`;\n                    } catch (e) {\n                      return 'N/A';\n                    }\n                  })()}\n                </p>\n              ) : (\n                <p className=\"text-2xl font-bold text-gray-400\">No payment</p>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* My Loans Section - Always show */}\n      <div className=\"mb-8\">\n        <div className=\"mb-4\">\n          <h2 className=\"text-xl font-bold text-gray-900\">My Loans</h2>\n          <p className=\"text-sm text-gray-600 mt-1\">\n            {loans.length > 1 ? 'View status and next payment for all your loans' : loans.length === 1 ? 'View your loan details' : 'You don\\'t have any loans yet'}\n          </p>\n        </div>\n        \n        {loans.length > 0 && loanPayments.length > 0 ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {loanPayments.map(({ loan, nextPayment: loanNextPayment, remainingBalance: loanRemainingBalance, schedule: loanSchedule }) => {\n              const loanCurrency = loan.loan_currency || loan.meta?.loan_currency || 'AUD';\n              const loanCurrencySymbol = getCurrencySymbol(loanCurrency);\n              \n              // Get remaining balance - prefer from schedule, fallback to loan data\n              let loanBalance = loanRemainingBalance || 0;\n              if (loanBalance === 0 || isNaN(loanBalance)) {\n                if (loanSchedule && loanSchedule.length > 0) {\n                  // Get from last segment of schedule\n                  const lastSegment = loanSchedule[loanSchedule.length - 1];\n                  loanBalance = parseFloat(lastSegment.remain_balance || 0);\n                }\n                if (loanBalance === 0 || isNaN(loanBalance)) {\n                  // Fallback to loan data\n                  loanBalance = parseFloat(\n                    loan.remaining_balance || \n                    loan.meta?.remaining_balance || \n                    loan.meta?.remain_balance || \n                    0\n                  );\n                }\n              }\n              \n              const loanStatus = loan.meta?.loan_status || loan.loan_status || 'Active';\n              \n              // Calculate total payment for display\n              const getTotalPayment = (payment) => {\n                if (!payment) return 0;\n                const totalPayment = parseFloat(payment.total_payment || 0);\n                if (totalPayment > 0) return totalPayment;\n                const principal = parseFloat(payment.paid_principles || payment.paid_principal || 0);\n                const interest = parseFloat(payment.accrued_interest || payment.paid_interest || 0);\n                return principal + interest;\n              };\n              \n              // Calculate days until payment\n              const getDaysUntilPayment = (payment) => {\n                if (!payment || !payment.paymentDate) return 'N/A';\n                try {\n                  const today = new Date();\n                  today.setHours(0, 0, 0, 0);\n                  const paymentDate = new Date(payment.paymentDate);\n                  paymentDate.setHours(0, 0, 0, 0);\n                  const diffTime = paymentDate - today;\n                  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n                  if (diffDays < 0) return `${Math.abs(diffDays)} days overdue`;\n                  if (diffDays === 0) return 'Due today';\n                  return `${diffDays} days`;\n                } catch (e) {\n                  return 'N/A';\n                }\n              };\n              \n              return (\n                <div\n                  key={loan.id}\n                  className={`bg-white rounded-lg border-2 p-5 cursor-pointer transition-all hover:shadow-md ${\n                    loanNextPayment?.isOverdue\n                      ? 'border-red-300 bg-red-50'\n                      : 'border-gray-200'\n                  }`}\n                  onClick={() => navigate(`/loans/${loan.id}`)}\n                >\n                  <div className=\"flex items-start justify-between mb-3\">\n                    <div className=\"flex-1\">\n                      <h3 className=\"font-semibold text-gray-900 mb-1\">\n                        {loan.title?.rendered || loan.loan_title || `Loan #${loan.id}`}\n                      </h3>\n                    </div>\n                    {loanNextPayment && getStatusBadge(loanNextPayment)}\n                  </div>\n                  \n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Status:</span>\n                      <span className=\"font-medium text-gray-900\">{loanStatus}</span>\n                    </div>\n                    \n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Balance:</span>\n                      <span className=\"font-medium text-gray-900\">\n                        {loanCurrencySymbol}{loanBalance.toFixed(2)}\n                      </span>\n                    </div>\n                    \n                    {loanNextPayment ? (\n                      <>\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-600\">Next Payment:</span>\n                          <span className={`font-medium ${\n                            loanNextPayment.isOverdue ? 'text-red-600' : 'text-gray-900'\n                          }`}>\n                            {formatDate(loanNextPayment.paymentDateStr)}\n                          </span>\n                        </div>\n                        \n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-600\">Amount:</span>\n                          <span className=\"font-semibold text-gray-900\">\n                            {loanCurrencySymbol}{getTotalPayment(loanNextPayment).toFixed(2)}\n                          </span>\n                        </div>\n                        \n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-600\">Days:</span>\n                          <span className={`font-medium ${\n                            loanNextPayment.isOverdue ? 'text-red-600' : 'text-gray-900'\n                          }`}>\n                            {getDaysUntilPayment(loanNextPayment)}\n                          </span>\n                        </div>\n                      </>\n                    ) : (\n                      <div className=\"text-center py-2 text-gray-500 text-xs\">\n                        No upcoming payments\n                      </div>\n                    )}\n                  </div>\n                  \n                  <div className=\"mt-4 pt-3 border-t border-gray-200\">\n                    <button\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        navigate(`/loans/${loan.id}`);\n                      }}\n                      className=\"w-full text-sm text-blue-600 hover:text-blue-700 font-medium\"\n                    >\n                      View Details →\n                    </button>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        ) : (\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-8\">\n            <div className=\"text-center py-8\">\n              <div className=\"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                <svg className=\"w-8 h-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 10h16M4 14h16M4 18h16\" />\n                </svg>\n              </div>\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Loans</h3>\n              <p className=\"text-sm text-gray-500\">You don't have any loans at this time.</p>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction LoansPage({ token }) {\n  const { profile } = useCurrentClient(token);\n  const [loans, setLoans] = useState([]);\n  const [loanStatuses, setLoanStatuses] = useState({}); // Store repayment status for each loan\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (!token || !profile) return;\n    const load = async () => {\n      setLoading(true);\n      setError('');\n      try {\n        const resp = await fetch(\n          `${apiBase}/wp/v2/loans?per_page=100&context=edit`,\n          { headers: getAuthHeaders(token), mode: 'cors' }\n        );\n        if (!resp.ok) throw new Error('Failed to load loans');\n        const data = await resp.json();\n        // Use comprehensive filtering function\n        const filtered = data.filter((loan) => isLoanForBorrower(loan, profile));\n        setLoans(filtered);\n\n        // Calculate repayment status for all loans based on loan end date (matching admin side logic)\n        const statusMap = {};\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n\n        for (const loan of filtered) {\n          // Calculate overall repayment status based on loan end date\n          let overallStatus = 'Pending';\n          \n          const endDateStr = loan.end_date || loan.meta?.end_date;\n          if (endDateStr) {\n            try {\n              const endDate = new Date(endDateStr);\n              endDate.setHours(0, 0, 0, 0);\n              \n              // Determine repayment status based on loan end date\n              // If current date > loan end date → \"Overdue\", otherwise → \"Pending\"\n              if (endDate < today) {\n                // Loan end date has passed\n                overallStatus = 'Overdue';\n              } else {\n                // Loan end date hasn't passed\n                overallStatus = 'Pending';\n              }\n            } catch (e) {\n              // If date parsing fails, default to Pending\n              overallStatus = 'Pending';\n            }\n          }\n\n          statusMap[loan.id] = overallStatus;\n        }\n\n        setLoanStatuses(statusMap);\n      } catch (e) {\n        setError(e.message || 'Failed to load loans');\n      } finally {\n        setLoading(false);\n      }\n    };\n    load();\n  }, [token, profile]);\n\n  const getRepaymentStatusBadge = (status) => {\n    // Loan-level repayment status (matching admin side):\n    // 1. \"Overdue\" (RED): Loan end date has passed\n    // 2. \"Pending\" (GRAY): Loan end date hasn't passed\n    const statusConfig = {\n      'Overdue': { bg: 'bg-red-100', text: 'text-red-800', border: 'border-red-300', icon: '⚠' },\n      'Pending': { bg: 'bg-gray-100', text: 'text-gray-800', border: 'border-gray-300', icon: '○' }\n    };\n    \n    const config = statusConfig[status] || statusConfig['Pending'];\n\n  return (\n      <span className={`inline-flex items-center px-3 py-1 rounded-full border-2 ${config.bg} ${config.text} ${config.border} font-bold text-xs`}>\n        <span className=\"mr-1.5\">{config.icon}</span>\n        <span>{status}</span>\n      </span>\n    );\n  };\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-8\">\n        <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\">\n      <div>\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">My Loans</h1>\n            <p className=\"text-gray-600\">View your active and past loans.</p>\n          </div>\n          <button\n            onClick={() => window.open('https://form.yourfinservices.com.au/loan-request/', '_blank', 'noopener,noreferrer')}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 self-start sm:self-center\"\n          >\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\n            </svg>\n            <span>Apply a new loan</span>\n          </button>\n        </div>\n      </div>\n      {loading && <p className=\"text-sm text-gray-500\">Loading loans...</p>}\n      {error && <p className=\"text-sm text-red-600\">{error}</p>}\n      {!loading && !error && loans.length === 0 && (\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center\">\n          <p className=\"text-gray-600\">You do not have any loans yet.</p>\n        </div>\n      )}\n      {loans.length > 0 && (\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Loan</th>\n                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Total Balance</th>\n                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Remaining Balance</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Loan Status</th>\n                <th className=\"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\">Repayment Status</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {loans.map((loan) => {\n                const currency = loan?.loan_currency || loan?.meta?.loan_currency || 'AUD';\n                const getCurrencySymbol = (c) => (c === 'MNT' ? '₮' : '$');\n                const totalBalance = loan.loan_amount || loan.meta?.loan_amount || 0;\n                const remainingBalance = loan.remaining_balance || loan.meta?.remaining_balance || loan.meta?.remain_balance || totalBalance;\n                \n                return (\n                <tr key={loan.id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                    {loan.title?.rendered || loan.loan_title || `Loan #${loan.id}`}\n                  </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right\">\n                      {getCurrencySymbol(currency)}{parseFloat(totalBalance).toFixed(2)}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right\">\n                      {getCurrencySymbol(currency)}{parseFloat(remainingBalance).toFixed(2)}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                    {loan.meta?.loan_status || 'Active'}\n                  </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-center\">\n                      {getRepaymentStatusBadge(loanStatuses[loan.id] || 'Pending')}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                    <button\n                      onClick={() => navigate(`/loans/${loan.id}`)}\n                        className=\"text-blue-600 hover:text-blue-700 font-medium\"\n                    >\n                      View details\n                    </button>\n                  </td>\n                </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction LoanDetailPage({ token }) {\n  const { id } = useParams();\n  const { profile } = useCurrentClient(token);\n  const [activeTab, setActiveTab] = useState('Loan Details');\n  const [loan, setLoan] = useState(null);\n  const [coBorrower, setCoBorrower] = useState(null);\n  const [schedule, setSchedule] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (!token || !id || !profile) return;\n    const load = async () => {\n      setLoading(true);\n      setError('');\n      try {\n        const loanResp = await fetch(\n          `${apiBase}/wp/v2/loans/${id}?context=edit`,\n          { headers: getAuthHeaders(token), mode: 'cors' }\n        );\n        if (!loanResp.ok) throw new Error('Failed to load loan');\n        const loanJson = await loanResp.json();\n        \n        // Security check: verify this loan belongs to the current user\n        if (!isLoanForBorrower(loanJson, profile)) {\n          setError('You do not have permission to view this loan.');\n          setLoading(false);\n          return;\n        }\n        \n        setLoan(loanJson);\n\n        // Fetch co-borrower if exists\n        const coStatus = loanJson.co_borrower_status || loanJson.meta?.co_borrower_status;\n        const coId = toId(loanJson.meta?.co_borrower_id) || toId(loanJson.co_borrower) || toId(loanJson.meta?.co_borrower);\n        if (coStatus && /^yes$/i.test(String(coStatus)) && coId) {\n          try {\n            const cbResp = await fetch(\n              `${apiBase}/wp/v2/borrower-profile/${coId}?context=edit`,\n              { headers: getAuthHeaders(token), mode: 'cors' }\n            );\n            if (cbResp.ok) {\n              setCoBorrower(await cbResp.json());\n            }\n          } catch (e) {\n            console.error('Failed to load co-borrower:', e);\n          }\n        }\n\n        const scheduleResp = await fetch(\n          `${apiBase}/echovault/v2/get-repayment-schedule?loan_id=${id}`,\n          { headers: { Authorization: `Bearer ${token}` }, mode: 'cors' }\n        );\n        if (scheduleResp.ok) {\n          const scheduleJson = await scheduleResp.json();\n          if (scheduleJson.success && scheduleJson.schedule) {\n            setSchedule(scheduleJson.schedule);\n          }\n        }\n      } catch (e) {\n        setError(e.message || 'Failed to load loan');\n      } finally {\n        setLoading(false);\n      }\n    };\n    load();\n  }, [token, id, profile]);\n\n  const currency = loan?.loan_currency || loan?.meta?.loan_currency || 'AUD';\n  const getCurrencySymbol = (c) => (c === 'MNT' ? '₮' : '$');\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-8\">\n        <button\n          onClick={() => navigate('/loans')}\n          className=\"text-sm text-gray-600 hover:text-gray-900 mb-4 inline-flex items-center\"\n        >\n          <svg className=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n          </svg>\n          Back to Loans\n        </button>\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Loan Details</h1>\n      </div>\n      {loading && <p className=\"text-sm text-gray-500\">Loading...</p>}\n      {error && <p className=\"text-sm text-red-600\">{error}</p>}\n      \n      {loan && (\n        <>\n          {/* Tabs Navigation */}\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 mb-6\">\n            <div className=\"border-b border-gray-200\">\n              <nav className=\"flex space-x-8 px-6\">\n                <button\n                  type=\"button\"\n                  onClick={() => setActiveTab('Loan Details')}\n                  className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                    activeTab === 'Loan Details'\n                      ? 'border-blue-500 text-blue-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  Loan Details\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => setActiveTab('Repayment Schedule')}\n                  className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                    activeTab === 'Repayment Schedule'\n                      ? 'border-blue-500 text-blue-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                  }`}\n                >\n                  Repayment Schedule\n                </button>\n              </nav>\n            </div>\n          </div>\n\n          {/* Tab Content */}\n          {activeTab === 'Loan Details' && (\n            <>\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm\">\n                  <div>\n                    <p className=\"text-gray-500\">Loan ID</p>\n                    <p className=\"font-medium text-gray-900 mt-1\">\n            {loan.title?.rendered || loan.loan_title || `Loan #${loan.id}`}\n          </p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500\">Status</p>\n                    <div className=\"mt-1\">\n                      <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                        {loan.meta?.loan_status || 'Active'}\n                      </span>\n                    </div>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500\">Repayment Status</p>\n                    <div className=\"mt-1\">\n                      {(() => {\n                        // Calculate overall repayment status based on loan end date (matching admin side logic)\n                        let overallStatus = 'Pending';\n                        let statusClass = 'bg-gray-100 text-gray-800';\n                        \n                        const endDateStr = loan.end_date || loan.meta?.end_date;\n                        if (endDateStr) {\n                          try {\n                            const today = new Date();\n                            today.setHours(0, 0, 0, 0);\n                            const endDate = new Date(endDateStr);\n                            endDate.setHours(0, 0, 0, 0);\n                            \n                            // Determine repayment status based on loan end date\n                            // If current date > loan end date → \"Overdue\", otherwise → \"Pending\"\n                            if (endDate < today) {\n                              // Loan end date has passed\n                              overallStatus = 'Overdue';\n                              statusClass = 'bg-red-100 text-red-800';\n                            } else {\n                              // Loan end date hasn't passed\n                              overallStatus = 'Pending';\n                              statusClass = 'bg-gray-100 text-gray-800';\n                            }\n                          } catch (e) {\n                            // If date parsing fails, default to Pending\n                            overallStatus = 'Pending';\n                            statusClass = 'bg-gray-100 text-gray-800';\n                          }\n                        }\n                        \n                        return (\n                          <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusClass}`}>\n                            {overallStatus}\n                          </span>\n                        );\n                      })()}\n                    </div>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500\">Loan Amount</p>\n                    <p className=\"font-medium text-gray-900 mt-1\">\n                      {getCurrencySymbol(currency)}{loan.loan_amount || loan.meta?.loan_amount || '0'}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500\">Currency</p>\n                    <p className=\"font-medium text-gray-900 mt-1\">{currency}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500\">Loan Product</p>\n                    <p className=\"font-medium text-gray-900 mt-1\">\n                      {loan.loan_product || loan.meta?.loan_product_name || '-'}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500\">Loan Interest</p>\n                    <p className=\"font-medium text-gray-900 mt-1\">\n                      {loan.loan_interest || loan.meta?.loan_interest || '-'}%\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500\">Loan Term</p>\n                    <p className=\"font-medium text-gray-900 mt-1\">\n                      {loan.loan_term || loan.meta?.loan_term ? `${loan.loan_term || loan.meta?.loan_term} months` : '-'}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500\">Repayment Method</p>\n                    <p className=\"font-medium text-gray-900 mt-1\">\n                      {loan.repayment_method || loan.meta?.repayment_method || '-'}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500\">Repayment Frequency</p>\n                    <p className=\"font-medium text-gray-900 mt-1\">\n                      {Array.isArray(loan.repayment_frequency) ? loan.repayment_frequency[0] : (loan.repayment_frequency || loan.meta?.repayment_frequency || '-')}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500\">Loan Start Date</p>\n                    <p className=\"font-medium text-gray-900 mt-1\">\n                      {loan.start_date || loan.meta?.start_date || '-'}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-gray-500\">Loan End Date</p>\n                    <p className=\"font-medium text-gray-900 mt-1\">\n                      {loan.end_date || loan.meta?.end_date || '-'}\n                    </p>\n                  </div>\n                </div>\n              </div>\n              \n              {/* Repayment Account Details */}\n              {(loan.loan_repayment_account || loan.meta?.loan_repayment_account) && (\n                <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6\">\n                  <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Repayment Account Details</h2>\n                  <div className=\"text-sm\">\n                    <p className=\"text-gray-500\">Repayment Account</p>\n                    <p className=\"font-medium text-gray-900 mt-1 break-all\">\n                      {loan.loan_repayment_account || loan.meta?.loan_repayment_account || '-'}\n                    </p>\n                  </div>\n        </div>\n      )}\n\n              {/* Co-borrower Details */}\n              {coBorrower && (\n                <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6\">\n                  <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Co-borrower Details</h2>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm\">\n                    <div>\n                      <p className=\"text-gray-500\">First Name</p>\n                      <p className=\"font-medium text-gray-900 mt-1\">\n                        {coBorrower.first_name || coBorrower.meta?.first_name || '-'}\n                      </p>\n          </div>\n                    <div>\n                      <p className=\"text-gray-500\">Last Name</p>\n                      <p className=\"font-medium text-gray-900 mt-1\">\n                        {coBorrower.last_name || coBorrower.meta?.last_name || '-'}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500\">Email Address</p>\n                      <p className=\"font-medium text-gray-900 mt-1 break-all\">\n                        {coBorrower.email_address || coBorrower.meta?.email_address || '-'}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500\">Mobile Number</p>\n                      <p className=\"font-medium text-gray-900 mt-1\">\n                        {coBorrower.mobile_number || coBorrower.meta?.mobile_number || '-'}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500\">Date of Birth</p>\n                      <p className=\"font-medium text-gray-900 mt-1\">\n                        {coBorrower.date_of_birth || coBorrower.meta?.date_of_birth || '-'}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500\">Document Type</p>\n                      <p className=\"font-medium text-gray-900 mt-1\">\n                        {coBorrower.document_type || coBorrower.meta?.document_type || '-'}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-500\">Document Number</p>\n                      <p className=\"font-medium text-gray-900 mt-1\">\n                        {coBorrower.document_number || coBorrower.meta?.document_number || '-'}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </>\n          )}\n\n          {activeTab === 'Repayment Schedule' && (\n            <>\n              {schedule.length > 0 ? (\n                <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\n          <div className=\"px-6 py-4 border-b border-gray-200\">\n            <h2 className=\"text-lg font-semibold text-gray-900\">Repayment Schedule</h2>\n          </div>\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200 text-xs\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                  <th className=\"px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase\">#</th>\n                  <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\">Start</th>\n                  <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\">End</th>\n                  <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase\">Paid Date</th>\n                  <th className=\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\">Days</th>\n                  <th className=\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\">Start Balance</th>\n                  <th className=\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\">Accrued Interest</th>\n                  <th className=\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\">Paid Interest</th>\n                  <th className=\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\">Paid Principal</th>\n                  <th className=\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\">Total Payment</th>\n                  <th className=\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\">Outstanding</th>\n                  <th className=\"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase\">Remain Balance</th>\n                  <th className=\"px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase\">Status</th>\n              </tr>\n            </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n              {schedule.map((r, index) => {\n                    // Determine status and badge color - match admin side logic exactly\n                    const originalStatus = String(r.repayment_status || 'Pending').trim();\n                    \n                    // Check if payment has been made - check payment data first\n                    const hasPayment = (r.total_payment && parseFloat(r.total_payment) > 0) \n                      || (r.paid_date && r.paid_date.trim() !== '' && r.paid_date !== '-')\n                      || (r.paid_interest && parseFloat(r.paid_interest) > 0)\n                      || (r.paid_principles && parseFloat(r.paid_principles) > 0)\n                      || (originalStatus.toLowerCase() === 'paid');\n                    \n                    // ONLY 2 STATUSES (matching admin side):\n                    // 1. \"Paid\" (GREEN): Payment has been made\n                    // 2. \"Pending\" (GRAY): No payment made\n                    let displayStatus = 'Pending';\n                    let statusClass = 'bg-gray-100 text-gray-800';\n                    \n                    if (hasPayment) {\n                      displayStatus = 'Paid';\n                      statusClass = 'bg-green-100 text-green-800';\n                    } else {\n                      displayStatus = 'Pending';\n                      statusClass = 'bg-gray-100 text-gray-800';\n                    }\n                    \n                    return (\n                  <tr key={r.id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-center\">{index + 1}</td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-500\">{r.segment_start || '-'}</td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-500\">{r.segment_end || '-'}</td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-500\">{r.paid_date || '-'}</td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\">{r.loan_days || 0}</td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\">\n                      {getCurrencySymbol(currency)}{(r.start_balance || 0).toFixed(2)}\n                    </td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\">\n                      {getCurrencySymbol(currency)}{(r.accrued_interest || 0).toFixed(2)}\n                    </td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\">\n                      {getCurrencySymbol(currency)}{(r.paid_interest || 0).toFixed(2)}\n                    </td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\">\n                      {getCurrencySymbol(currency)}{(r.paid_principles || 0).toFixed(2)}\n                    </td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\">\n                      {getCurrencySymbol(currency)}{(r.total_payment || 0).toFixed(2)}\n                    </td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\">\n                      {getCurrencySymbol(currency)}{(r.outstanding_interest || 0).toFixed(2)}\n                    </td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-900 text-right\">\n                      {getCurrencySymbol(currency)}{(r.remain_balance || 0).toFixed(2)}\n                    </td>\n                    <td className=\"px-3 py-2 whitespace-nowrap text-center\">\n                      <span className={`px-2 py-1 rounded text-xs font-medium ${statusClass}`}>\n                        {displayStatus}\n                      </span>\n                  </td>\n                </tr>\n                    );\n              })}\n            </tbody>\n          </table>\n          </div>\n        </div>\n              ) : (\n                <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center\">\n                  <p className=\"text-gray-600\">No repayment schedule available.</p>\n        </div>\n              )}\n            </>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nfunction ProductsPage({ token }) {\n  const [products, setProducts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    if (!token) return;\n    const load = async () => {\n      setLoading(true);\n      setError('');\n      try {\n        const resp = await fetch(\n          `${apiBase}/wp/v2/loan-product?per_page=100&status=publish`,\n          { headers: getAuthHeaders(token), mode: 'cors' }\n        );\n        if (!resp.ok) throw new Error('Failed to load products');\n        const data = await resp.json();\n        setProducts(data || []);\n      } catch (e) {\n        setError(e.message || 'Failed to load products');\n      } finally {\n        setLoading(false);\n      }\n    };\n    load();\n  }, [token]);\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-8\">\n        <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Active Loan Products</h1>\n            <p className=\"text-gray-600\">Browse available loan products.</p>\n          </div>\n        </div>\n      </div>\n      {loading && <p className=\"text-sm text-gray-500\">Loading products...</p>}\n      {error && <p className=\"text-sm text-red-600\">{error}</p>}\n      {!loading && !error && products.length === 0 && (\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center\">\n          <p className=\"text-gray-600\">No active products available.</p>\n        </div>\n      )}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {products.map((p) => (\n          <div\n            key={p.id}\n            className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\"\n          >\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n              {p.product_name || p.title?.rendered || 'Loan Product'}\n            </h3>\n            {p.product_description && (\n              <p className=\"text-sm text-gray-600 mb-4\">{p.product_description}</p>\n            )}\n            <div className=\"space-y-2 text-sm\">\n              {p.min_amount && (\n                <p className=\"text-gray-600\">\n                  <span className=\"font-medium\">Min Amount:</span> ${p.min_amount}\n                </p>\n              )}\n              {p.max_amount && (\n                <p className=\"text-gray-600\">\n                  <span className=\"font-medium\">Max Amount:</span> ${p.max_amount}\n                </p>\n              )}\n              {p.interest_rate && (\n                <p className=\"text-gray-600\">\n                  <span className=\"font-medium\">Interest Rate:</span> {p.interest_rate}%\n                </p>\n              )}\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction NewsPage() {\n  const [posts, setPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    const load = async () => {\n      setLoading(true);\n      setError('');\n      try {\n        // First, get the category ID for \"system-news\" slug\n        const categoryResp = await fetch(\n          'https://yourfinservices.com.au/wp-json/wp/v2/categories?slug=system-news',\n          { mode: 'cors' }\n        );\n        \n        let categoryId = null;\n        if (categoryResp.ok) {\n          const categories = await categoryResp.json();\n          if (categories && categories.length > 0) {\n            categoryId = categories[0].id;\n          }\n        }\n        \n        // Fetch posts from the external site\n        // If category found, filter by category, otherwise fetch all posts\n        const postsUrl = categoryId\n          ? `https://yourfinservices.com.au/wp-json/wp/v2/posts?categories=${categoryId}&per_page=20&_embed`\n          : 'https://yourfinservices.com.au/wp-json/wp/v2/posts?per_page=20&_embed';\n        \n        const resp = await fetch(postsUrl, {\n          mode: 'cors'\n        });\n        \n        if (!resp.ok) {\n          throw new Error('Failed to load news');\n        }\n        \n        const data = await resp.json();\n        setPosts(data || []);\n      } catch (e) {\n        console.error('Error loading news:', e);\n        setError(e.message || 'Failed to load news');\n      } finally {\n        setLoading(false);\n      }\n    };\n    load();\n  }, []);\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-8\">\n        <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">News</h1>\n            <p className=\"text-gray-600\">Latest updates and announcements.</p>\n          </div>\n        </div>\n      </div>\n      {loading && <p className=\"text-sm text-gray-500\">Loading news...</p>}\n      {error && (\n        <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n          <p className=\"text-sm text-yellow-800\">{error}</p>\n          <p className=\"text-xs text-yellow-600 mt-1\">\n            Unable to load news from external source. Please try again later.\n          </p>\n        </div>\n      )}\n      \n      {!loading && !error && posts.length === 0 && (\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center\">\n          <p className=\"text-gray-600\">No news articles found.</p>\n        </div>\n      )}\n      \n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {posts.map((post) => {\n          // Get featured image if available - try multiple paths\n          const getFeaturedImage = (post) => {\n            if (!post) return null;\n            \n            // Try embedded media\n            const embeddedMedia = post._embedded?.['wp:featuredmedia']?.[0];\n            if (embeddedMedia) {\n              // Try source_url first\n              if (embeddedMedia.source_url) return embeddedMedia.source_url;\n              // Try media_details sizes\n              if (embeddedMedia.media_details?.sizes) {\n                const sizes = embeddedMedia.media_details.sizes;\n                // Try large, medium_large, medium, or full\n                if (sizes.large?.source_url) return sizes.large.source_url;\n                if (sizes['medium_large']?.source_url) return sizes['medium_large'].source_url;\n                if (sizes.medium?.source_url) return sizes.medium.source_url;\n                if (sizes.full?.source_url) return sizes.full.source_url;\n              }\n            }\n            \n            // Try direct featured_media_url\n            if (post.featured_media_url) return post.featured_media_url;\n            \n            return null;\n          };\n          \n          const featuredImage = getFeaturedImage(post);\n          \n          // Get excerpt or content\n          const excerpt = post.excerpt?.rendered || post.content?.rendered || '';\n          // Strip HTML tags for preview (keep first 120 chars for grid layout)\n          const textContent = excerpt.replace(/<[^>]*>/g, '').substring(0, 120);\n          \n          return (\n            <article key={post.id} className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow flex flex-col\">\n              {featuredImage && (\n                <div className=\"w-full h-40 overflow-hidden bg-gray-100\">\n                  <img \n                    src={featuredImage} \n                    alt={post.title?.rendered || 'News image'}\n                    className=\"w-full h-full object-cover\"\n                    onError={(e) => {\n                      e.target.style.display = 'none';\n                    }}\n                  />\n                </div>\n              )}\n              <div className=\"p-4 flex-1 flex flex-col\">\n                <h3 className=\"text-base font-semibold text-gray-900 mb-2 line-clamp-2\">\n              {post.title?.rendered || 'News'}\n            </h3>\n                <p className=\"text-xs text-gray-500 mb-2\">\n                  {new Date(post.date).toLocaleDateString('en-US', { \n                    year: 'numeric', \n                    month: 'short', \n                    day: 'numeric' \n                  })}\n                </p>\n                <div className=\"text-xs text-gray-600 mb-3 flex-1 line-clamp-3\">\n                  {textContent}\n                  {textContent.length >= 120 && '...'}\n                </div>\n                {post.link && (\n                  <a\n                    href={post.link}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"inline-flex items-center text-xs text-blue-600 hover:text-blue-700 font-medium mt-auto\"\n                  >\n                    Read more\n                    <svg className=\"w-3 h-3 ml-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                    </svg>\n                  </a>\n                )}\n              </div>\n          </article>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\n// Avatar utility function\nfunction getAvatarByBorrowerId(borrowerIdOrBorrower) {\n  const avatarImages = [\n    'monster.svg',\n    'monster (1).svg',\n    'monster (2).svg',\n    'monster (3).svg',\n    'monster (4).svg',\n    'monster (5).svg',\n    'monster (6).svg',\n    'monster (7).svg',\n    'monster (8).svg',\n    'monster (9).svg',\n    'monster (10).svg',\n    'monster (11).svg',\n    'monster (12).svg'\n  ];\n\n  let avatarFilename = null;\n  \n  if (typeof borrowerIdOrBorrower === 'object' && borrowerIdOrBorrower !== null) {\n    const borrower = borrowerIdOrBorrower;\n    let savedAvatar = borrower.avatar || \n                     borrower.meta?.avatar || \n                     borrower.fields?.avatar ||\n                     (Array.isArray(borrower.avatar) ? borrower.avatar[0] : null) ||\n                     (Array.isArray(borrower.meta?.avatar) ? borrower.meta.avatar[0] : null);\n    \n    if (savedAvatar && typeof savedAvatar === 'object') {\n      savedAvatar = savedAvatar.name || savedAvatar.filename || savedAvatar.url || savedAvatar;\n    }\n    \n    if (savedAvatar && typeof savedAvatar === 'string' && savedAvatar.trim()) {\n      avatarFilename = savedAvatar.trim();\n    }\n    \n    if (!avatarFilename) {\n      const borrowerId = borrower.id || borrower.ID;\n      if (borrowerId) {\n        const avatarIndex = borrowerId % avatarImages.length;\n        avatarFilename = avatarImages[avatarIndex];\n      }\n    }\n  } else if (typeof borrowerIdOrBorrower === 'number') {\n    const borrowerId = borrowerIdOrBorrower;\n    const avatarIndex = borrowerId % avatarImages.length;\n    avatarFilename = avatarImages[avatarIndex];\n  }\n  \n  if (!avatarFilename) {\n    avatarFilename = avatarImages[0];\n  }\n  \n  return `/avatars/${avatarFilename}`;\n}\n\nfunction LoanCalculatorPage() {\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-8\">\n        <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Loan Calculator</h1>\n            <p className=\"text-gray-600\">Estimate repayments and terms</p>\n          </div>\n        </div>\n      </div>\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center\">\n        <div className=\"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n          <svg className=\"w-12 h-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M7 7h10M7 11h10M9 15h6M9 19h6\" />\n          </svg>\n        </div>\n        <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">Calculator coming soon</h3>\n        <p className=\"text-gray-500 max-w-md mx-auto\">We will add repayment and term estimation here with inputs and instant results.</p>\n      </div>\n    </div>\n  );\n}\n\nfunction ProfilePage({ token }) {\n  const { profile, loading, error } = useCurrentClient(token);\n  const [activeTab, setActiveTab] = useState('general');\n\n  const field = (val) =>\n    val === null || val === undefined || val === '' ? '-' : String(val);\n\n  const fullName = profile \n    ? `${profile.first_name || ''} ${profile.last_name || ''}`.trim() || 'Unknown Client'\n    : 'Unknown Client';\n  const initials = fullName.split(' ').map(n => n[0]).join('').toUpperCase();\n\n  return (\n    <div className=\"p-6\">\n      {loading && <p className=\"text-sm text-gray-500\">Loading profile...</p>}\n      {error && <p className=\"text-sm text-red-600\">{error}</p>}\n      {!loading && !error && !profile && (\n        <p className=\"text-sm text-gray-500\">\n          No client profile is linked to this account yet.\n        </p>\n      )}\n\n      {profile && (\n        <>\n          {/* Header - matching admin side */}\n          <div className=\"mb-8\">\n            <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex items-center\">\n                  <img\n                    src={getAvatarByBorrowerId(profile)}\n                    alt={fullName}\n                    className=\"w-16 h-16 rounded-full object-cover mr-4\"\n                    onError={(e) => {\n                      e.target.style.display = 'none';\n                      e.target.nextSibling.style.display = 'flex';\n                    }}\n                  />\n                  <div \n                    className=\"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-xl mr-4 hidden\"\n                  >\n                    {initials}\n                  </div>\n                  <div>\n                    <h1 className=\"text-2xl font-bold text-gray-900 mb-1\">\n                      {fullName}\n                    </h1>\n                    <div className=\"flex items-center gap-4\">\n                      <p className=\"text-gray-600\">ID: {profile.id || '-'}</p>\n                      <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                        Active\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\n            {/* Tabs */}\n            <div className=\"border-b border-gray-200\">\n            <nav className=\"flex space-x-8 px-6\">\n              <button\n                type=\"button\"\n                onClick={() => setActiveTab('general')}\n                className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                  activeTab === 'general'\n                    ? 'border-blue-500 text-blue-600'\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n              >\n                General Information\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setActiveTab('visa')}\n                className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                  activeTab === 'visa'\n                    ? 'border-blue-500 text-blue-600'\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n              >\n                Visa Status\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setActiveTab('employment')}\n                className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                  activeTab === 'employment'\n                    ? 'border-blue-500 text-blue-600'\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n              >\n                Employment\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setActiveTab('family')}\n                className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                  activeTab === 'family'\n                    ? 'border-blue-500 text-blue-600'\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n              >\n                Family Information\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setActiveTab('bank')}\n                className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                  activeTab === 'bank'\n                    ? 'border-blue-500 text-blue-600'\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n              >\n                Bank Details\n              </button>\n            </nav>\n          </div>\n\n          {/* Tab content – read only */}\n          <div className=\"p-6 text-sm text-gray-900\">\n            {activeTab === 'general' && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <p className=\"text-gray-500 mb-1\">First Name</p>\n                  <p className=\"font-medium\">{field(profile.first_name)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Last Name</p>\n                  <p className=\"font-medium\">{field(profile.last_name)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Email</p>\n                  <p className=\"font-medium\">{field(profile.email_address)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Borrower ID</p>\n                  <p className=\"font-medium\">\n                    {field(profile.borrower_id || profile.meta?.borrower_id)}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Date of Birth</p>\n                  <p className=\"font-medium\">{field(profile.date_of_birth)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Mobile Number</p>\n                  <p className=\"font-medium\">{field(profile.mobile_number)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Registration Number</p>\n                  <p className=\"font-medium\">\n                    {field(profile.registration_number)}\n                  </p>\n                </div>\n                <div className=\"md:col-span-2\">\n                  <p className=\"text-gray-500 mb-1\">Home Address</p>\n                  <p className=\"font-medium whitespace-pre-line\">\n                    {field(profile.home_address)}\n                  </p>\n                </div>\n        </div>\n            )}\n\n            {activeTab === 'visa' && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Visa Type</p>\n                  <p className=\"font-medium\">{field(profile.visa_type)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Visa Expiry Date</p>\n                  <p className=\"font-medium\">\n                    {field(profile.visa_expiry_date)}\n                  </p>\n                </div>\n              </div>\n            )}\n\n            {activeTab === 'employment' && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Employment Status</p>\n                  <p className=\"font-medium\">\n                    {field(profile.employment_status)}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Work Rights</p>\n                  <p className=\"font-medium\">{field(profile.work_rights)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Employer Name</p>\n                  <p className=\"font-medium\">{field(profile.employer_name)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Job Title</p>\n                  <p className=\"font-medium\">{field(profile.job_title)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Monthly Income (AUD)</p>\n                  <p className=\"font-medium\">\n                    {field(profile.monthly_income_aud)}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Employment Start Date</p>\n                  <p className=\"font-medium\">\n                    {field(profile.employment_start_date)}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Employer Phone</p>\n                  <p className=\"font-medium\">\n                    {field(profile.employer_phone)}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Employer Email</p>\n                  <p className=\"font-medium\">\n                    {field(profile.employer_email)}\n                  </p>\n                </div>\n                <div className=\"md:col-span-2\">\n                  <p className=\"text-gray-500 mb-1\">Employer Address</p>\n                  <p className=\"font-medium whitespace-pre-line\">\n                    {field(profile.employer_address)}\n                  </p>\n                </div>\n              </div>\n            )}\n\n            {activeTab === 'family' && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Marital Status</p>\n                  <p className=\"font-medium\">\n                    {field(profile.marital_status)}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Family Relationship</p>\n                  <p className=\"font-medium\">\n                    {field(profile.family_relationship)}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Family Member Name</p>\n                  <p className=\"font-medium\">\n                    {field(profile.family_member_full_name)}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Family Member Phone</p>\n                  <p className=\"font-medium\">\n                    {field(profile.family_member_phone)}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Family Member Email</p>\n                  <p className=\"font-medium\">\n                    {field(profile.family_member_email)}\n                  </p>\n                </div>\n              </div>\n            )}\n\n            {activeTab === 'bank' && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Bank Name</p>\n                  <p className=\"font-medium\">{field(profile.bank_name)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Account Name</p>\n                  <p className=\"font-medium\">{field(profile.account_name)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">BSB Number</p>\n                  <p className=\"font-medium\">{field(profile.bsb_number)}</p>\n                </div>\n                <div>\n                  <p className=\"text-gray-500 mb-1\">Account Number</p>\n                  <p className=\"font-medium\">{field(profile.account_number)}</p>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n        </>\n      )}\n    </div>\n  );\n}\n\nfunction ClientApp() {\n  const [token, setToken] = useState(localStorage.getItem('jwt_token'));\n  const [user, setUser] = useState(() => {\n    try {\n      const s = localStorage.getItem('user');\n      return s ? JSON.parse(s) : null;\n    } catch {\n      return null;\n    }\n  });\n  const { profile } = useCurrentClient(token);\n  const location = useLocation();\n\n  const getCurrentView = () => {\n    const path = location.pathname;\n    if (path === '/' || path === '/dashboard') return 'dashboard';\n    if (path.startsWith('/loans')) return 'loans';\n    if (path === '/products') return 'products';\n    if (path === '/news') return 'news';\n    if (path === '/profile') return 'profile';\n    return 'dashboard';\n  };\n\n  const handleLogout = () => {\n    localStorage.removeItem('jwt_token');\n    localStorage.removeItem('user');\n    window.location.reload();\n  };\n\n  if (!token) {\n    return (\n      <Login\n        onLoginSuccess={(newToken, userData) => {\n          setToken(newToken);\n          setUser(userData);\n        }}\n      />\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"flex\">\n        <Sidebar currentView={getCurrentView()} />\n        <div className=\"flex-1 flex flex-col\">\n          <Header user={user} profile={profile} onLogout={handleLogout} />\n        <Routes>\n            <Route path=\"/\" element={<DashboardPage token={token} user={user} />} />\n            <Route path=\"/dashboard\" element={<DashboardPage token={token} user={user} />} />\n          <Route path=\"/loans\" element={<LoansPage token={token} />} />\n          <Route path=\"/loans/:id\" element={<LoanDetailPage token={token} />} />\n          <Route path=\"/products\" element={<ProductsPage token={token} />} />\n          <Route path=\"/loan-calculator\" element={<LoanCalculatorPage />} />\n          <Route path=\"/news\" element={<NewsPage />} />\n          <Route path=\"/profile\" element={<ProfilePage token={token} />} />\n        </Routes>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <BrowserRouter>\n      <ClientApp />\n    </BrowserRouter>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}